<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Python中的可行替代方案</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Python中的可行替代方案</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-13 12:53:13</div><div class="page_narrow text-break page_content"><p>我的VPS(虚拟专用服务器)变旧了，运营它的公司宣布，下个月，我使用的促销活动将到期，现在运行它的费用将超过三倍。另外，我还想更新家里的其他机器，因为它们使用的是旧的Ubuntu。</p><p>这促使我寻求某种部署自动化，这样我就可以将我的基础设施指定为代码，理想情况下再也不会花太多时间使用它。</p><p>我不喜欢过度成长为脚本语言的基于YAML的配置语言。这是格林斯潘第十条规则的经典例子：</p><p>任何足够复杂的C或Fortran程序都包含半个Common Lisp的临时的、非正式指定的、充满错误的、缓慢的实现。</p><p>调试它是一场噩梦，IDE没有支持等等。</p><p>每次我尝试使用Ansible时的混乱感觉让我开始探索替代方案，最好是用python，它将定义食谱或任何简单的python代码。</p><p>几乎每一篇关于Python Ansible Alternative主题的文章都提到了织物。它看起来很棒，但看起来有点不同。它是用于在远程主机上运行命令的系统。这绝对是Ansible所做的工作的一部分，但我也想要某种抽象层。</p><p>&gt；&gt；&gt；def disk_free(C)：.。uname=c。运行(&#39；uname-s&39；，Hide=True).。如果Linux&#39；在uname中。标准输出：.。命令=&#34；df-h/|ail-n1|awk&#39；{打印$5}&#39；&#34；.。返回c。Run(COMMAND，HIDE=True)。STDOUT(标准)。条带().。错误=&#34；不知道如何获取{}！&#34；上的磁盘空间。格式化(未命名).。提升出口(错误)</p><p>我的意思是，我不想手动运行apt install nginx，然后解析输出并尝试决定命令是否成功运行(我以前用paramiko做过，相信我，这并不有趣)。</p><p>我想要稍微高级一点的东西，它可以为我解析标准实用程序，理想情况下支持多操作系统，这样当我决定使用CentOS而不是我现在使用的Ubuntu服务器时，它可以为我处理不同的实用程序。</p><p>从Fabric.api导入*从Fabtools导入需要导入Fabtools@task def setup()：#需要一些Debian/Ubuntu包需要。黛比。Packages([&#39；imagemagick&#39；，&#39；libxml2-dev&#39；，])#需要带有Fabtools的Python包。蟒蛇。viralenv(&#39；/home/myuser/env&#39；)：必需。蟒蛇。包(#39；金字塔#)#需要电子邮件服务器要求。后缀。server(&#39；example.com&#39；)#需要PostgreSQL服务器要求。波斯格雷斯。server()需要。波斯格雷斯。用户(&#39；myuser&#39；，&#39；s3cr3tp4ssw0rd&#39；)需要。波斯格雷斯。数据库(#39；myappsdb&39；，#39；myuser&39；)#需要针对我们的应用程序要求的主管进程。主管。进程(&#39；myapp&#39；，command=&#39；/home/myuser/env/bin/genicorn_paster/home/myuser/env/myapp/Production.ini&#39；，directory=&#39；/home/myuser/env/myapp&#39；，user=&#39；myuser&#39；)#需要代理我们的应用程序所需的nginx服务器。恩吉克斯。PROXED_SITE(&#39；example.com&#39；，docroot=&#39；/home/myuser/env/myapp/myapp/public&39；，proxy_url=&#39；http://127.0.0.1:8888&#39；)#设置每日cron任务。克伦。添加_DAILY(&#39；维护&#39；，&#39；myuser&#39；，&#39；my_script.py&#39；)。</p><p>上一次提交是在9个月前，有78个未解决的问题，28个等待的拉取请求，支持的操作系统列表已经很古老了：</p><p>从Fabrix.api导入IS_FILE_NOT_EXISTS，yum_INSTALL从Fabrix.api导入EDIT_FILE，EDIT_INI_SECTION，REPLACE_LINE DEF INSTALL_PHP()：if is_FILE_NOT_EXISTS(&#34；/etc/yum.repos.d/epel.repo&#34；)：YUM_INSTALL(&#34；https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm&#34；如果文件不存在(&#34；/etc/yum.repos.d/remi-php70.repo&#34；)：百胜安装(&#34；https://rpms.remirepo.net/enterprise/remi-release-7.rpm&#34；)编辑文件(&#34；/etc/yum.repos.d/remi-php70.repo&#34；，edit_ini_Section(&#34；[remi-php70]&#34；，REPLACE_LINE(&#34；Enabled=0&#34；，&#34；Enabled=1&#34；))yum_install(&#34；&#34；&#34；php-cli php-common php-fpm php-gd php-mbstring php-mysql php-pdo php-pear php-ecl-imagick php-process php-xml php-opcache php-mcrypt php-soap&#。</p><p>这对我来说有点好笑，因为我前段时间和帕拉米科创造了一些非常相似的东西。</p><p>它看起来也死了，只有204个提交和一个贡献者，上一次提交是在15个月前。我不想把我的系统建立在已经死了的东西上。</p><p>Pyinfra看起来很有希望，而且还没有死：2233次提交，14个贡献者，最后一次提交是在昨天。这就是我要说的！</p><p>示例完全按照我的要求工作；声明性语言，重要的参数是参数，而不是字符串。唯一奇怪的是将描述指定为集合，但无论如何，我可以看到这里的推理路线。</p><p>由于Pyinfra是唯一一种看起来没有死的东西，它可以做我想做的事情，所以这个决定并不难。那么，让我们试一试吧：</p><p>现在让我们试试hello world。我在端口上挣扎了一会儿，因为我使用非标准端口来隧道通过酒店和机场wifi，快速浏览一下可以帮助显示我应该使用--port参数：</p><p>$pyinfra kitakitsune.org--端口443 EXEC--ECHO&#34；hello world&#34；--&gt；正在加载配置.--&gt；正在连接到主机.。[kitakitsune.org]已连接--&gt；建议的更改：取消分组：[kitakitsune.org]操作：1命令：1--&gt；开始操作运行.--&gt；开始操作：服务器/Shell(u&#39；echo hello world&#39；，)[kitakitsune.org]hello world[kitakitsune.org]成功--&gt；结果：取消分组：[kitakitsune.org]成功：1。</p><p>看上去不错。让我们尝试为虚拟Ubuntu服务器创建一个更复杂的部署，这是我不久前在VirtualBox中创建的。我对inventory.py文件有点费劲，但是后来我在文档中找到了正确的参数：</p><p>--&gt；正在加载配置.--&gt；正在加载清单.--&gt；正在连接到主机.。[192.168.0.106]已连接--&gt；正在准备操作.。加载：ployment ment.py[192.168.0.106]Ready：ployment.py--&gt；建议的更改：组：My_Hosts/Inventory[192.168.0.106]操作：1命令：1--&gt；开始操作运行.--&gt；启动操作：服务器/Shell(&#39；echo&#34；hello world&#34；&#39；)[192.168.0.106]&gt；&gt；sh-c&#39。&#39；[192.168.0.106]hello world[192.168.0.106]成功--&gt；结果：组：My_Hosts/Inventory[192.168.0.106]成功：1错误：0命令：1/1。</p><p>--&gt；启动操作：服务器/Shell(&#39；echo&#34；hello world&34；&#39；，)[192.168.0.106]&gt；&gt；&gt；sudo-S-H-nsh-c&39；echo&#34；hello world&#34；&#39；[192.168.0.106]sudo：需要密码[192.168.0.106]错误--&gt；pyinfra错误：否。</p><p>我在谷歌上搜索并查看了文档和源代码，但看起来没有办法指定sudo密码，我觉得这非常奇怪。有人甚至在前一天制造了一个问题：</p><p>看起来不支持带密码的sudo。因此，我已经通过更改行在/etc/sudoers中禁用了sudo密码。</p><p>--&gt；正在加载配置.--&gt；正在加载清单.--&gt；正在连接到主机.。[192.168.0.106]已连接--&gt；正在准备操作.。加载：ployment ment.py[192.168.0.106]Ready：ployment.py--&gt；建议的更改：组：My_Hosts/Inventory[192.168.0.106]操作：1命令：1--&gt；开始操作运行.--&gt；启动操作：服务器/Shell(&#39；echo&#34；hello world&#34；&#39；)[192.168.0.106]&gt；&gt；sudo-S-H。Hello world&#34；&#39；[192.168.0.106]hello world[192.168.0.106]成功--&gt；结果：组：MY_HOSTS/Inventory[192.168.0.106]成功：1错误：0命令：1/1。</p><p>让我们来尝试一些更复杂的方法--设置一台nginx服务器并为其上传正确的配置文件：</p><p>而且它是有效的，只有一个例外，那就是解析输出(是的，这就是解析糟糕的原因)：</p><p>回溯(最近一次调用)：文件&#34；src/gevent/greenlet.py&#34；，第854行，在gevent中。_gevent_cgreenlet.Greenlet.run文件&#34；/home/bystrousak/.local/lib/python2.7/site-packages/pyinfra/api/util.py&#34；，第471行，在READ_BUFFER_PRINT(行)文件&#34；/home/bystrousak/.local/lib/python2.7/site-packages/pyinfra/api/util.py&#34；中。第455行，in_print line=Print_Func(Line)文件&#34；/home/bystrousak/.local/lib/python2.7/site-packages/pyinfra/api/connectors/util.py&#34；，行61，in&lt；lambda&gt；print_func=lambda line：&#39；{0}{1}&#39；.format(print_prefix，line)，UnicodeEncodeError：&#39；ascii&#39；编解码器可以&#39；\u2192&#39；t编码字符u&#39；\u2192&#39；在位置74：序号不在范围内(128)2020-06-11T23：55：28Z&lt；0x7fde3f4dd6b0处的Greenlet：Read_Buffer(&#39；stdout&39；，&lt；paramiko.ChannelFile from&lt；paramiko.Channel 2(OP；队列在0x7fde39f60f30队列=deque([(&#39；stdout&#39；结果：组：My_Hosts/Inventory[192.168.0.106]成功：1错误：0命令：1/1。</p><p>这也很奇怪，但我可能使用捷克语本地化，所以我并不感到惊讶。</p><p>--&gt；正在加载配置.--&gt；正在加载清单.--&gt；正在连接到主机.。[192.168.0.106]已连接--&gt；正在准备操作.。正在加载：deployment.py已加载事实Deb_Packages[192.168.0.106]Ready：deployment.py--&gt；建议的更改：组：My_Hosts/Inventory[192.168.0.106]操作：1命令：1--&gt；开始操作运行.--&gt；开始操作：APT/Packages(&#39；nginx&#39；，u&#39；update=True&#39；，u&#39；Present=True&#39；)。sudo-S-H-nsh-c&#39；apt-get update&#39；[192.168.0.106]HIT：1 http://archive.ubuntu.com/ubuntu Bionic InRelease[192.168.0.106]HIT：2 http://archive.ubuntu.com/ubuntu Bionic-Updates InRelease[192.168.0.106]HIT：3 http://archive.ubuntu.com/ubuntu Bionic-Backports InRelease[192.168.0.106]HIT：4 http://archive.ubuntu.com/ubuntu Bionic-Security InRelease[192.168.0.106]正在读取包列表.。[192.168.0.106]成功--&gt；结果：组：My_Hosts/Inventory[192.168.0.106]成功：1错误：0命令：1/1。</p><p>我真的很喜欢金丝雀。它有它的怪癖，但它们只是一些小烦恼，不像我在其他产品中发现的大烦恼，比如Ansible。但与Ansible不同的是，它易于理解、易于使用，而且它使用的是Python，我知道并喜欢Python，而且我的IDE可以提供自动补全和调试器，这与其他基于YAML的领域特定语言不同。</p><p>模块导入文件sudo=True apt，从pyInfrastructure导入apt。模块从pyInfrastructure导入init，导入文件sudo=True apt。软件包(&#39；nginx&39；，update=True，Present=True)文件。将(&#39；configs/nginx.conf&#39；，&#39；/etc/nginx/nginx.conf&#39；，user=&#39；root&#39；，group=&#39；root&#39；，mode=&#39；644&#39；，)初始化。systemd(&#39；nginx&#39；，Running=True，Restarted=True，Enabled=True，)。</p><p>改变了关于Ansible的激烈语气，因为这不是重点。添加了关于VS Code Ansible插件的标注。</p><p>是的，我的英语可能很糟糕，但这类博客帖子还不符合(付费)语法更正的资格(队列中有优先级更高的东西)。如果你想改变这一点，请订阅“我的守护神”(My Patreon)。即使每月只有1美元，你也可以有所作为。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://blog.rfox.eu/en/Explorations/Trying_Ansible_alternatives_in_python.html">http://blog.rfox.eu/en/Explorations/Trying_Ansible_alternatives_in_python.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/替代/">#替代</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/php/">#php</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1006250.html"><img src="http://img.diglog.com/img/2020/6/thumb_139b74ead05f3327f4e19cdc593f1f8a.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006250.html">使用此Python加密算法永远不会忘记您的密码</a></div><span class="my_story_list_date">2020-6-12 10:16</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005830.html"><img src="http://img.diglog.com/img/2020/6/thumb_e343f2ca5ac0b2ff53dfeb1e79b9bb04.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005830.html">Pycopy-最低限度且节省内存的Python实现</a></div><span class="my_story_list_date">2020-6-9 18:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005223.html"><img src="http://img.diglog.com/img/2020/6/thumb_1a27806716a24982e78fd4e369f63a07.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005223.html">ChupaCarBrah-使用Beaglebone和Python进行汽车黑客攻击</a></div><span class="my_story_list_date">2020-6-5 7:9</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005190.html"><img src="http://img.diglog.com/img/2020/6/thumb_8776c4dbcffb05b1efc63c1943c1c4ae.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005190.html">立体设计原则的Pythonic指南-Dev</a></div><span class="my_story_list_date">2020-6-5 4:3</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>