<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我用的是无吸盘工具</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">我用的是无吸盘工具</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-06 19:59:56</div><div class="page_narrow text-break page_content"><p>软件是复杂的。桌面环境的基本构建块每年都在增长，直到难以理解或维护。Suckless为这种持续不断的膨胀和毫无意义的重新设计提供了另一种选择。默认情况下，Suckless工具的目标是让事情变得简单、最小、可用和可破解。他们的窗口管理器DWM只是一个窗口管理器。它不处理诸如透明度、合成或音量控制之类的事情。他们的终端st只是一个终端。它不能处理像很久以前就灭绝的远古终结者那样的奇幻事物。它只显示文本。它不能处理tmux或类似产品可以处理的事情，因为在这方面，tmux可以比st自己做得更好。</p><p>无吸盘工具通常是用C语言来配置的，但是作为无吸盘工具在编译时将其配置烘焙到可执行文件中的副作用，它们会立即启动。如果在使用它们时出现问题，您可以很容易地直接跳到实现它们的代码中，并使用基本的调试器技能来解决问题。</p><p>然而，即使窗口管理器很简陋，它仍然为您提供了让它看起来更漂亮的地方。有关漂亮的DWM设置的示例，请参见reddit上的/r/unixporn搜索。</p><p>我想介绍一下我的DWM设置，我是如何配置正在运行的所有部件的，以及一个如何在DWM配置中调试问题的示例。</p><p>由于DWM是用C语言配置的，所以也有一群人在为DWM创建补丁，这些补丁添加了额外的功能，比如附加的平铺方法、自动启动DWM的能力、状态栏的透明度等等。我使用以下补丁：</p><p>这种补丁的组合让我感觉非常舒适和可预测，这样我就可以完全依靠肌肉记忆来管理我的窗口了。几乎所有的操作都是通过键盘完成的。</p><p>工作区名称(我的名称基于unicode表情符号(ﾉ◕ヮ◕)ﾉ*：·ﾟ✧))。</p><p>所有这些都控制着各种勘误表。作为使它们全部编译时间常量的副作用，这些设置不必加载到程序中，因为它们已经是程序的一部分。我在我的桌面和emacs上使用Hack字体。</p><p>平铺窗口管理器的真正魔力在于，所有的窗口管理命令都是通过我的键盘来完成的。Alt是我一直致力于控制窗口管理器的关键。我所有的窗口管理器控制和弦都使用ALT键。</p><p>这只是我可以完成任务的足够命令，但不会太多，以至于我不知所措，忘记了keybind做什么。我的大部分工作都是为了增强记忆力(我必须查看配置文件才能写出这个表)，因此我几乎所有的窗口管理都是通过键盘完成的。</p><p>我配置的其余部分可以处理Alt-right-Click任意调整窗口大小、dwmc信号和其他开销之类的事情。</p><p>我的桌面环境的其余部分是使用在DWM之上构建的其他一些工具构建的。您可以在这里看到我为其制作的NixOS模块：</p><p>这些工具中的每一个在堆栈中都有自己的位置，它们都一起工作，为我提供了一个连贯而有凝聚力的环境，我可以在Netflix、编程、玩蒸汽游戏等方面使用它。</p><p>Cabytcini是我为自己创建的一个程序，作为我更熟悉铁锈的目标的一部分。在撰写本文时，它只使用了11兆字节的RAM，并使用位于~/.config/Cabytcini/gpostcu&#39；a.toml的配置文件进行配置。它从我的壁挂式时钟使用的API服务器上收集数据，向我显示蒙特利尔的天气。我一直想写更多关于它的东西，但目前只在Lojban有记录。</p><p>软件是不完美的，即使是像DWM这样的小程序也可能有错误。下面是我最近如何调试和平分dwmconfig问题的故事。</p><p>我刚刚设置了第二个监视器，并注意到每当我向其发送窗口时，整个窗口管理器似乎都被锁定了。我尝试发送Quit命令，看看它是否会对此做出响应，但失败了。我使用CONTROL-ALT-F1打开uPA虚拟终端并登录，然后启动HTOP查看进程是否被阻止。</p><p>它报告DWM使用100%的CPU。这很奇怪。然后我决定打开调试器，看看是怎么回事。我使用gdb-p(Pgrep DWM)附加到DWM进程，然后运行bt full以查看它停滞在哪里。</p><p>回溯显示它卡在Drawbar()函数中。它被卡在一个环路里，看起来像这样：</p><p>对于(c=m-&gt;；客户端；c；c=c-&&gt;；下一个){occ|=c-&gt；标记；如果(c-&&gt;；为紧急)urg|=c-&&gt;；标记；}。</p><p>DWM将每个标记的客户端列表存储在一个单链表中，因此根本原因可能与循环链表有某种关联，对吗？</p><p>我决定通过在gdb中输出c和c-&gt；NEXT来检查这一点，看看发生了什么：</p><p>链表是循环的。DWM陷入无限循环迭代。我看了看c的类型，发现它是这样的：</p><p>struct client{char name[256]；Float Mina，Maxa；Float CFACT；int x，y，w，h；int oldx，oldy，oldw，oldh；int basew，baseh，incw，in，maxw，maxh，minw，minh；int bw，oldbw；unsign int tag；int is Fixed，is浮动，is urent，Never Focus，oldstate，isfullscreen；client*Next；client*snext；monitor*mon；</p><p>因此，NEXT是指向下一个客户端的指针(如果存在)。将指针设置为NULL可能会使DWM脱离无限循环。因此，我决定通过运行以下命令来测试这一点：</p><p>若要将下一个指针设置为NULL，请执行以下操作。DWM立即松开并退出(显然我之前的QUIT命令被缓冲)，导致登录屏幕显示。我可以得出结论，我的DWM设置有问题。</p><p>我知道这个行为在DWM的发布版本上有效，所以我决定加载KDE，然后看看xephyr和gitdicect是怎么回事。</p><p>我注册了错误提交(当前提交)和最后一个已知的好提交(从DWM6.2发布时开始)，并开始重新创建挂起条件。</p><p>一旦启动并运行了DWM，我就创建了一个终端窗口，并尝试将其发送到另一个屏幕。如果它起作用，我用git HalectGood将提交标记为好，如果它挂起，我用git dicectgood将提交标记为坏。7次迭代后，我发现下面所附的补丁才是罪魁祸首。</p><p>我恢复了主分支上的补丁，重新构建并重新运行了DWM，并尝试在假监视器之间发送终端窗口。每次都很管用。然后我提交了以下附件的还原，将其推送到我的NURrepo，然后在它通过CI后重新构建了我的塔的配置。</p><p>作为一个好的互联网公民，我把这件事报告给了无吸吮的邮件列表，然后我不仅确认了这个漏洞，而且还得到了一个补丁，可以永远修复这个行为。我还没有将这个元补丁集成到我的DWM分支中，但我可能有一天会用到它。</p><p>这确实完美地展示了无吸哲学的核心租户之一。我不是很熟悉DWM代码库是如何工作的，但我能够深入它的内部并诊断/修复问题，因为它是故意保持尽可能简单的。</p><p>如果你在台式机/笔记本电脑上使用Linux，我强烈建议你看一看不成功的软件，并尝试一下。它对可理解性和黑客攻击进行了超级优化，这在当今是一种巨大的新鲜空气。</p><p>这篇文章发表在2020M65。自发表以来，事实和情况可能发生了变化。如果有什么不对劲或不清楚的地方，请在匆忙下结论之前与我联系。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://christine.website/blog/why-i-use-suckless-tools-2020-06-05">https://christine.website/blog/why-i-use-suckless-tools-2020-06-05</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/吸盘/">#吸盘</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/suckless/">#suckless</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/dwm/">#dwm</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>