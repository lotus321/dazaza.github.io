<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>通过9个简单的步骤保护您的Kubernetes网络</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">通过9个简单的步骤保护您的Kubernetes网络</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-25 02:47:35</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/5/963859ba2fe9868605321da5adccef43.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>为集群内的安全通信配置Kubernetes安全性可能非常令人困惑。朱莉娅·埃文斯(Julia Evans)在她的博客中写道：</p><p>各种Kubernetes组件都有大量不同的位置，您可以在其中放置证书/证书颁发机构。当我们设置集群时，我感觉证书、密钥和证书颁发机构有大约100亿个不同的命令行参数，我不明白它们是如何组合在一起的。</p><p>Kube API服务器-负责群集的整体功能并与用户交互。这基本上是您群集的控制中心。</p><p>其中API服务、kubelet和etcd是最关键的组件。假设Pod需要证书，它将与kubelet通信，然后kubelet将与API服务器通信以访问存储在etcd中的证书。</p><p>与主服务器的所有通信都通过API服务器进行。同样，与Worker节点的所有通信都通过kubelet进行。etcd保存集群的所有重要信息。因此，任何与etcd通信的东西都应该得到很好的保护。</p><p>API服务器与kubelet通信以获取日志，从用户接收配置，并与kubelet通信以使其成为现实。</p><p>默认情况下，从API服务器到kubelet的通信是通过未经验证的TLS进行的。这使得在不受信任的网络上运行群集是不安全的，因为这种通信容易受到中间人(或女人)的攻击。如果您在您的私有网络上运行，这种行为应该是可以接受的。但是，如果您愿意，可以使用“kubelet-Certificate-Authority”标志来验证kubelet的服务器证书。注SSH隧道已弃用，因此不再是推荐的解决方案。</p><p>在一些情况下会发生这种情况，例如当一个新节点联机，并且该节点需要一个新证书来与API服务器通信时。API服务器有一个Kubernetes API，它可以让您获得由您可以控制的CA签名的TLS证书。</p><p>请求使用相互TLS和API服务器在端口443上侦听。因此，默认情况下，主服务器可以在不受信任的网络上运行。</p><p>这里需要注意的另一件事是，您需要为kubelet证书设置证书轮换。默认情况下，它们的有效期为1年。</p><p>此通信的身份验证方法取决于您的需要。有几个选项，例如：</p><p>如果特定节点或Pod向kubelet请求证书，kubelet向API服务器发出请求，然后API服务器从etcd获取证书，则可能会发生这种情况。</p><p>与etcd的通信通过端口80上的本地主机进行，并且未经过身份验证或加密。您应该为通信的这一部分设置TLS，以便通过指定标志“etcd-certfile”向etcd服务器验证etcd实例的身份。</p><p>etcd的实例已经通过相互TL进行通信，因此集群的这一部分在不受信任的网络上运行也应该是安全的。</p><p>如您所知，不同节点或相同节点中的Pod之间无需NAT的无缝通信是Kubernetes组网的基本原则之一。所以这是另一条重要的沟通途径。</p><p>目前，此通信未加密且未进行身份验证。有一些方法可以使其更安全，例如使用一些网络策略提供商，如Tigera的Calico或Cilium来保护服务到服务的流量。至少，强烈建议根据您的应用程序使用某些网络策略提供程序。</p><p>您还可以使用像Istio这样的服务网格来对服务之间的流量实施相互TLS。仅使用整个服务网格来实施服务到服务通信之间的相互TLS似乎是一个巨大的要求，因此可以使用提供相同服务的网络策略提供程序，而不需要在每个Pod前面使用代理。</p><p>这里推荐的一件显而易见的事情是Pod安全策略。将在另一篇博客文章中详细说明这一点。</p><p>这条沟通路径非常关键，可能需要一个完整的帖子。</p><p>这种类型的通信是通过纯HTTP完成的，但实际上这种类型的通信甚至不应该直接发生。</p><p>用于保护从Kube控制器管理器到API服务器的通信。默认情况下，它使用端口10259并使用HTTPS身份验证。您还可以设置该选项和许多其他选项：</p><p>从Kubernetes1.13开始，安全端口10259可以用于Kube-Scheduler到api服务器的安全连接。</p><p>如果您希望确保节点到节点的通信也使用证书，则可以使用相同的证书签名API。</p><p>如果您发现上述内容有任何错误，将乐意改正，或者如果您有任何反馈，希望听到更多信息！</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/p/secure-kubernetes-internal-networking-5f2556f7efde">https://medium.com/p/secure-kubernetes-internal-networking-5f2556f7efde</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/保护/">#保护</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/通信/">#通信</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>