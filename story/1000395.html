<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>构建您自己的WebAssembly编译器</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1>构建您自己的WebAssembly编译器</h1><div class="row"><div class="col-lg-8 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time">2020-05-03 03:12:26</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/5/394b52164dcab22052e41dca0334b63d.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><p>您有没有想过编写自己的编译器？…。什么事？…。你当然有！我一直想尝试编写编译器，随着WebAssembly最近的发布，我有了一个完美的理由来尝试一下。</p><p>我最初的计划是发明我自己的编程语言，创建一个面向WebAssembly的编译器，并在FullStackNYC分享我的经验。第一部分进行了计划，我花了很多时间来构建、修补和改进我的编译器。不幸的是，我计划的最后一部分进行得不太顺利。长时间的延误和最终的取消意味着我终究不能去纽约了。😔😢😭。</p><p>因此，与其浪费所有的工作-我想我应该把我的演讲写成博客帖子-所以这篇文章的阅读时间就是‘19分钟’。所以请坐，请自便，我们要开始…了。</p><p>如果你以前没有听说过WebAssembly，并且想要一个真正详细的介绍，我会向你彻底推荐林克拉克的卡通指南。</p><p>在这篇博客文章中，您将了解WebAssembly的“是什么”，但我确实想简要介绍一下“为什么”。</p><p>上图显示了在浏览器中执行某些JavaScript代码的简化时间线。从左到右，代码(通常是以最小的乱七八糟的形式交付的！)。被解析成AST，最初在解释器中执行，然后逐步优化/重新优化，直到它最终运行得非常快。现在JavaScript速度很快--只需要一段时间就能跟上速度。</p><p>底部的关系图相当于WebAssembly。用多种语言(RUST、C、C#等…)编写的代码。编译为以二进制格式交付的WebAssembly。这非常容易解码、编译和执行-提供快速和可预测的性能。</p><p>WebAssembly在过去的一年里引起了不小的轰动。如此之多，以至于在Stack Overflow的开发者洞察力调查中，它被评为第五种“最受欢迎”的语言。</p><p>考虑到对于大多数人来说，WebAssembly是一个编译目标，而不是他们将直接使用的语言，这是一个有趣的结果。</p><p>这是我最初提出FullStackNYC演讲的部分动机。WebAssembly的技术方面真的很吸引人(让我想起几十年前的8位计算机)，然而大多数人永远没有机会涉足WebAssembly本身-它只是一个他们编译到的黑匣子。</p><p>编写编译器真的是一个很好的机会，可以深入研究WebAssembly的细节，找出它是什么以及它是如何工作的。而且这也很有趣！</p><p>最后一点，我的目标从来不是创建一种功能齐全的编程语言，也不是一种真正好的编程语言。我的目标是创建一种“足够的”语言，使我能够编写一个程序来呈现曼德布罗特集(Mandelbrot Set)。该语言是使用我的编译器编译成WebAssembly的，该编译器是用打字脚本编写的，并在浏览器中运行。</p><p>我最后给语言鸿沟打了个电话，如果你愿意，你可以在网上玩。</p><p>在处理编译器之前，我们将从更简单的东西开始，创建一个最小的WebAssembly模块。</p><p>下面是一个发射器(该术语用于描述为目标系统输出指令的编译器部分)，它创建最小的有效WebAssembly模块：</p><p>常量magicModuleHeader=[0x00，0x61，0x73，0x6d]；常量模块版本=[0x01，0x00，0x00，0x00]；导出常量发射器：发射器=()=&gt；Uint8Array。从([.。MagicModuleHeader，.。ModeVersion])；</p><p>它由两部分组成，“Magic”头(即ASCII字符串\0asm)和版本号。这八个字节形成有效的WebAssembly(或wasm)模块。更典型的情况是，这些文件将作为.wasm文件传送到浏览器。</p><p>如果运行上面的命令，您会发现该实例实际上并不执行任何操作，因为我们的wasm模块不包含任何指令！</p><p>如果您有兴趣亲自尝试这段代码，可以在GitHub上找到--每一步都有一个提交。</p><p>让我们通过实现一个将两个浮点数相加的函数来使wasm模块做一些更有用的事情。</p><p>WebAssembly是一种二进制格式，可读性不是很好(至少对人类而言)，这就是为什么您通常会看到它是以WebAssembly文本格式(WAT)编写的。下面是一个以WAT格式呈现的模块，它定义了一个名为$add的导出函数，该函数接受两个浮点参数，然后将它们相加并返回：</p><p>(MODULE(func$add(Param F32)(Param F32)(Result F32)GET_LOCAL 0 GET_LOCAL 1 f32.add)(export&#34；add&#34；(Func 0)。</p><p>如果您只想体验一下Wat，可以使用WebAssembly二进制工具包中的wat2wasm工具将WAT文件编译成wasm模块。</p><p>WebAssembly是一种低级语言，只有一小部分(大约60条)指令集，其中许多指令与CPU指令的映射非常紧密。这使得将wasm模块编译成特定于CPU的机器码变得很容易。</p><p>它没有内置的</p><div class="text-break sotry_link"><a target="_blank" href="https://blog.scottlogic.com/2019/05/17/webassembly-compiler.html">https://blog.scottlogic.com/2019/05/17/webassembly-compiler.html</a></div><div class="story_tags"><button type="button" class="btn btn-light my_tag"><a href="/tag/编译/">#编译</a></button></div></div></div><div class="col-lg-4 col-0"><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>