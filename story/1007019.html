<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在ARMv7-A CPU上以528 MHz的速度在0.37秒内启动嵌入式Linux</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在ARMv7-A CPU上以528 MHz的速度在0.37秒内启动嵌入式Linux</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-18 06:03:04</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/6/d0921b920798fbcd1322173bb0bb1054.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>基于嵌入式Linux的系统在开机后0.33秒进入用户空间。EXT4文件系统在0.37秒内准备就绪，在2.2秒内完成联网。具有528 MHz ARMv7-A CPU、1 GB DDR3 RAM和4 GB eMMC的i.MX6UL SoC令人印象深刻！重新启动甚至更快，从发出重新启动到进入用户空间只需要0.26秒。</p><p>请注意，除EXT4文件系统之外的所有软件都是安全引导链的一部分。如果没有安全引导，系统的引导速度会更快，但幸运的是我没有机会尝试。</p><p>首先，电源打开了。大约1毫秒后，硬件将重置释放到i.MX6UL，很快ROM代码从eMMC读取引导加载程序，验证其完整性并跳转到它。它产生185毫秒的时间，远远超过预期。这是很难做任何事情，因为这是正版恩智浦软件。</p><p>Punchboot引导加载程序开箱即用速度非常快，为了使其更快，删除了设备树修补程序(现在已完成编译时)，并将eMMC类型从DDR52更改为HS200。引导加载程序从eMMC读取Linux内核(3.5MB)、内存磁盘(1.4MB)和设备树(8kB)，并在86毫秒内验证它们。然后它启动Linux内核。没有其他引导加载程序浪费，甚至U-Boot也没有。</p><p>该系统的微型Linux内核(版本4.14.78)在大约62毫秒内启动，这是非常快的。这是通过最小的内核配置、几个补丁、最小的设备树以及未压缩的内核和内存镜像来实现的。</p><p>消除了MMC驱动程序中不必要的延迟(我希望如此)。这是可能的，因为我们非常清楚哪个MMC安装在电路板上，并且它始终处于通电状态。</p><p>以MMC时钟频率52 MHz开始，安装400 kHz。就像上一颗子弹一样。</p><p>10 Hz以太网PHY轮询，而不是1 Hz。如果PHY在其链路连接时发送中断，则不需要。</p><p>静态链接的初始化进程是ramdisk的一部分，它包含整个应用程序。它是用C语言实现的，开销低，内存和CPU时间都很短。没有叉子。没有剧本。没有共享库。然而，它不包含cURL和其他库，这使得它大约800kB。</p><p>EXT4文件系统(不使用dmverity进行完整性检查)在进入用户空间后40ms内挂载。启用程序是提前启动自定义的MMC驱动程序。</p><p>到目前为止，联网需要最长的时间来做好准备。主要原因是以太网自动协商需要相当长的时间，大约1到3秒。不需要以太网或可以使用无线链路配置的用户可以节省大量时间。</p><p>下面是Linux内核日志中的精选消息，以更好地了解正在发生的事情。日志中也有一些用户空间消息。</p><p>[0.000000]物理CPU0x0[0.000000]Linux4.14.78版(ERIK@ERIK-GR8)(GCC 9.1.0版(GCC))#1星期二16 19：18：46 UTC 2020[0.022802]解包initramf.[0.025535]mmc0：2190000.usdhc[2190000.usdhc]上的sdhi控制器使用adma[0.034262]释放initrd内存：1416K[0.035840]释放未使用的initrd内存。/ROOT/fe.ko&#39；.[0.053621]1970-01-01 00：00：00：00 INFO DEFAULT已成功插入&#39；/ROOT/ext4.ko&#39；.[0.057696]fec 218800。以太网eth0：已注册的PHC设备0[0.058009]mmcblk0：p1 p2 p3 p4 p5 p6[0.076813]ext4-fs(Mmcblk0p3)：使用有序数据模式挂载的文件系统。选项：(NULL)[0.082744]1970年-01-01 00：00：00信息默认值/ext4fs/自述文件：+-+[0.082812]1970-01-01 00：00：00信息默认值/ext4fs/自述文件：|Monolinux Jiffy|[0.082869]1970-01-01 00：00：00信息默认值/ext4fs/自述文件：+。LAN8710/LAN8720 218800。以太网-1：01：连接的PHY驱动程序[SMSC LAN8710/LAN8720](MII_Bus：PHY_Addr=218800。以太网-1：01，IRQ=轮询)[0.114607]ipv6：addrconf(Netdev_Up)：eth0：链路未就绪[1.892754]fec 218800。以太网eth0：链路打开-100 Mbps/全流控制rx/tx[1.892791]ipv6：addrconf(Netdev_Change)：eth0：链路就绪[1.893268]1970-01-01 00：00：01 info dhcp_client从接口&#39开始；eth0&#39；.[1.900520]1970年-01-01 00：00：01信息dhcp_client已收到报价数据包。</p><p>硬件：RST_N高ROM代码：GPIO低引导加载器：GPIO高Linux：&#34；Main&#34；printedFilessystem：dmesg&#34；已装载.&#34；-dmesg&#34；正在释放.&#34；+&#34；Main&#34；printedNetwork：dmesg&#34；收到报价.&#34；-dmesg&#34；正在释放.&#34；+&#34；Main&#34</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/eerimoq/monolinux-jiffy#boot-time">https://github.com/eerimoq/monolinux-jiffy#boot-time</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/cpu/">#cpu</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/embedded/">#embedded</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1006531.html"><img src="http://img.diglog.com/img/2020/6/thumb_7fb836a6397ace5165ee984af280735a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006531.html">Linux Sucks 2020[视频]</a></div><span class="my_story_list_date">2020-6-14 23:9</span></div><div class="col-sm"><div><a target="_blank" href="/story/1006520.html"><img src="http://img.diglog.com/img/2020/6/thumb_7fb836a6397ace5165ee984af280735a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006520.html">Linux Sucks 2020</a></div><span class="my_story_list_date">2020-6-14 18:17</span></div><div class="col-sm"><div><a target="_blank" href="/story/1006445.html"><img src="http://img.diglog.com/img/2020/6/thumb_209edd200677092eaf0a9648fea8f95b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006445.html">从正在运行的Windows系统安装Linux，不需要带电的USB</a></div><span class="my_story_list_date">2020-6-14 3:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1006173.html"><img src="http://img.diglog.com/img/2020/6/thumb_288617a3c7b4f8d226535fb806f796d0.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006173.html">Linux发行版回顾：System76的Pop_OS</a></div><span class="my_story_list_date">2020-6-12 2:37</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>