<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用Terraform集成Datadog和AWS</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用Terraform集成Datadog和AWS</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-16 05:35:24</div><div class="page_narrow text-break page_content"><p>我们喜欢度量，但讨厌手动流程。当我们在AWS集成中采用Datadog的内置功能时，我们迫不及待地想将AWS CloudWatch指标导入到Datadog中，但首先我们需要自动执行设置它所需的大量手动步骤。Datadog的AWS集成功能相当强大，一旦启用，它将自动将指定的CloudWatch指标同步到Datadog帐户。基本上，CloudWatch中的任何可用内容都可以很容易地在Datadog中与我们所有其他指标和仪表盘一起使用。</p><p>尽管集成功能强大且方便，但其设置过程实际上相当复杂。如Datadog文档中所述，需要18个手动步骤，包括：</p><p>如果您像我们一样拥有多个AWS帐户，您可能更喜欢自动执行此操作！在我们的例子中，这意味着使用Terraform。</p><p>在这篇博客文章中，我们想要分享Scribd如何使用Terraform在整个组织范围内自动化我们的Datadog和AWS集成。</p><p>为了解决这个问题，我们构建了terraform-aws-datadog模块。只需对HCL代码进行耦合，Terraform将执行所有必要步骤，以使用Scribd的最佳实践设置Datadog与特定AWS帐户的集成：</p><p>模块&#34；datadog&#34；{SOURCE=&#34；git：：https://github.com/scribd/terraform-aws-datadog.git?ref=master&#34；aws_account_id=data.。AWS_CALLER_IDENTITY。当前。account_id datadog_api_key=var。datadog_api_key env=&#34；产品&#34；命名空间=&#34；Team_Foo&#34；}。</p><p>从AWS账户维护人员的角度来看，使用模块是继承集中化最佳实践的便捷方式。对于模块维护器，可以使用标准的Terraform模块发布流程发布对Datadog集成模块的任何更改。</p><p>最初，该模块只设置基础集成。随着采用率的增加，各个团队向该模块添加了更多功能。其中一个功能是自动设置CloudWatch的日志接收。</p><p>就像设置官方的AWS集成应用程序一样，日志同步的说明有点不堪重负。</p><p>模块DATADOG&#34；{SOURCE=&#34；git：：https://github.com/scribd/terraform-aws-datadog.git?ref=master&#34；DATADOG_APIKEY=var.。datadog_api_key env=&#34；产品&#34；名称空间=&#34；project_foo&#34；cloudwatch_log_group=[&#34；cloudwatch_log_group_1&#34；，&#34；cloudwatch_log_group_2&#34；]}。</p><p>就这样!。TerraForm将自动为指定日志组创建Datadog无服务器功能和触发器，以将所有CloudWatch日志转发到Datadog。在运行Terraform Apply之后，您应该能够在几分钟内看到日志显示在Datadog中。</p><p>通过将指标和日志同步到Datadog中，我们能够利用Datadog作为所有事物监控的中心中心。我们计划在将Scribd的基础设施迁移到AWS时，为该模块带来更多功能。</p><p>通过官方AWS集成获取的指标会被耦合分钟延迟，这不适合用作监控关键系统的信号。有机会通过自动设置Datadog代理来实现实时指标同步。</p><p>datadog-serverless-函数repos包含另外两个基于lambda的AWS扩展，我们可以将其添加为模块的可用功能：vpc_flow_log_monitor和rds_enhanced_monitor。</p><p>特别感谢泰勒·麦克卢尔(Taylor McClure)和汉密尔顿·霍德(Hamilton Hord)开始这个项目，以及赛基兰·伯尔(Sai Kiran Burle)、卡姆兰·法哈迪(Kamran Farhadi)和尤金·皮门诺夫(Eugene Pimenov</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://tech.scribd.com/blog/2020/managing-datadog-aws-with-terraform.html">https://tech.scribd.com/blog/2020/managing-datadog-aws-with-terraform.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/terraform/">#terraform</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/integrate/">#integrate</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/datadog/">#datadog</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>