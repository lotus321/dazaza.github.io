<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>受APL启发的一个Ruby语句中的生命游戏</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">受APL启发的一个Ruby语句中的生命游戏</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-17 09:52:06</div><div class="page_narrow text-break page_content"><p>不过，让我解释一下。上周，我偶然发现了一个新的APL道歉帖子。它深深地触动了我的心弦，并给了我一种冲动，想要再次尝试理解这种美丽而奇怪的语言。</p><p>我(有点出乎意料地)发现，除了使用广泛的字符集和极端简洁之外，APL还有两个与Ruby一点也不陌生的主要特性：通过操作链接进行计算，以及适合于所述链接的扩展的数组操作库(在Ruby中，它们由Enumerable模块表示)。</p><p>在这一点上，我觉得可能一些APL方法和示例可以非常直接地转换为Ruby，这将是惯用的Ruby。为了挑战这种感觉，我尝试翻译著名的APL单行代码Conway的Game of Life实现，并成功地在一条Ruby语句中实现了GOL。</p><p>当然，实现需要“数学数组”的概念，与APL的概念相匹配，所以从技术上讲，它是“一条语句加支持类”，但我仍然倾向于将其视为“一条语句”的概念，因为实现的类是通用的(有点像Numo：：Narray)，并且所使用的操作对任何Rubyist来说都很熟悉。</p><p>要立即查看最终实现，您可以直接跳到回购。本文的其余部分将严格按照APL版本中的解释来完成实现过程。</p><p>在APL中，array是一个数学数组：它是一个由标量组成的矩形多维矩阵。在Ruby代码中用APL：：Ary表示，在下面的解释中简称为AA。</p><p>标量是数字、字符或其他数组。这意味着不应该混淆多维数组(矩阵，在某一维旁边有相等数量的元素)和嵌套数组。示例：</p><p>放置AA[1，2，3，4]。RESHAPE(2，2)#1 2#3 4#--二维数字矩阵放入AA[AA[1，2]，AA[3，4]]#┌─┐┌─┐#│1 2││3 4│#└─┘└─┘#--两个一维数组的一维数组。#注意嵌套数组周围的框架有助于理解嵌套</p><p>A=AA[1，2]放入#1 2放入a。WRAP#┌─┐#│12│#└─┘放置一个。包起来。展开#1 2。</p><p>与通常的数学数组一样，可以使用标量(如“将2加到每个元素”)或另一个相同形状的数组(如“将数组A的项添加到数组B的类似位置的项”)来执行数学运算。</p><p>话虽如此，让我们从生活游戏的第一代开始吧：</p><p>current_gen=aa[0，0，0，0，0，0，0，1，1，0，0，1，1，0，0，0，0，1，0，0，0，1，0，0]。RESHAPE(5，5)将CURRENT_GEN#0 0 0#0 0 1 1 0#0 1 1 0 0#0 0 1 0 0#0 0 0。</p><p>到目前为止，我们刚刚创建了一个由1和0组成的数组，并将其“重塑”为5×5的二维矩阵。</p><p>放置current_gen。hRotate(1)#0 0 0#0 1 1 0 0#1 1 0 0#0 1 0 0 0#0 0 0。</p><p>#hRotate只是将每行中的值循环向左移位，类似于(仅一维)Array#Rotation of Ruby。</p><p>现在，让我们生成旋转的3种变体：1种向左，无一种，1种向右：</p><p>当前一代。包起来。产品(AA[-1，0，1]，&amp；：hRotate)#┌─┐#│0 0 0││0 0 0││0 0 0│#│0 0 0 1 1 1││0 0 1 1 0││0 1 1 0 0│#│0 0 1 1 0││0 1 1 0 0││1 1 0 0 0│。#│0 0 0 1 0││0 0 1 0 0││0 1 0 0 0│#│0 0 0││0 0 0││0 0 0│#└─┘。</p><p>让我们从#product开始：它类似于Ruby的Array#product(将两个数组进行所有可能的组合)，但有一个重要的区别：APL的“product”不只是生成组合，而是接受立即应用于它们的操作。因此，在香草红宝石中：</p><p>这里的#WRAP是必需的，所以我们将只产生一个完整的数组(作为标量)-1、0和1，而不是每个数字每个行。</p><p>现在，让我们进行更多的旋转，将所有数字垂直移位-1、0和1：</p><p>放置current_gen。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(AA[-1，0，1]，&amp；：vRotate)#┌─┐#│0 0 0││0 0 0││0 0 0 1 1│#│0 0 0││0 0 0 1 1││0 0 1 1 0│#│0 0 0 1 1││0 0 1 1 0││0 0 0 1 0│。#│0 0 1 1 0││0 0 0 1 0││0 0 0│#│0 0 0 1 0││0 0 0││0 0 0│#└─┘#┌─┐┌─┐┌──。─┐#│0 0 0││0 0 0││0 0 1 1 0│#│0 0 0││0 0 1 1 0││0 1 1 0 0│#│0 0 1 1 0││0 1 1 0 0││0 0 1 0 0│#│0 1 1 0 0││0 0 1 0 0││0 0 0│#│0 0 1 0。0││0 0 0││0 0 0│#└─┘#┌─┐#│0 0 0││0 0 0││0 1 1 0 0│。#│0 0 0││0 1 1 0 0││1 1 0 0 0│#│0 1 1 0 0││1 1 0 0 0││0 1 0 0 0│#│1 1 0 0 0││0 1 0 0 0││0 0 0│#│0 1 0 0 0││0 0 0││0 0 0│#└─┘└。─┘└─┘。</p><p>请注意，我们当前看到的是由2维矩阵(5×5)组成的2维矩阵(3×3)：内部矩阵被包裹在帧中。</p><p>放置current_gen。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(aa[-1，0，1]，&amp；：vRotate)。Reduce(&amp；：+)。Reduce(&amp；：+)#┌─┐#│0 1 2 2 1│#│1 3 4 3 1│#│1 4 5 4 1│#│1 3 3 2 0│#│0 1 1 1│#└─┘。</p><p>这里的#Reduce是相同的可枚举数#Reduce。重要的特性是APL样式的数组是按元素求和的，所以现在我们有了所有9个矩阵的总和，表示每个单元有多少活动邻居(包括其自身)。</p><p>现在，应该注意的是，下一代应该只有3或4个细胞存活：</p><p>单元格为3表示“活着+2个邻居”(活着的条件)或“空着3个邻居”(变成活着的条件)。</p><p>4的意思是“活着+3个邻居”(活着的条件)或“空着，有4个邻居”(不是活着的条件)。</p><p>为了检查“它是否等于某物”，我们实现了.eq运算符。这可能是解决方案中最“非Rubyish”的部分：它不是生成true/false，而是提供1/0。不幸的是，对于算法来说，始终保持数字形式很重要。</p><p>放置current_gen。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(aa[-1，0，1]，&amp；：vRotate)。Reduce(&amp；：+)。Reduce(&amp；：+)。eq(3)#┌─┐#│0 0 0│#│0 1 0 1 0│#│0 0 0│#│0 1 1 0 0│#│0 0 0│#└─┘PUT CURRENT_GEN。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(aa[-1，0，1]，&amp；：vRotate)。Reduce(&amp；：+)。Reduce(&amp；：+)。EQ(4)#┌─┐#│0 0 0│#│0 0 1 0 0│#│0 1 0 1 0│#│0 0 0│#│0 0 0│#└─┘。</p><p>但是，我们也可以同时应用这两种操作，从而产生两个元素的数组(在APL中，多次执行一个操作的能力称为渗透)：</p><p>放置current_gen。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(aa[-1，0，1]，&amp；：vRotate)。Reduce(&amp；：+)。Reduce(&amp；：+)。EQ(AA[3，4])#┌─┐┌─┐#│0 0 0││0 0 0│#│0 1 0 1 0 0││0 0 1 0 0│#│0 0 0││0 1 0 1 0 0│#│0 1 1 0 0││0 0 0│#│0 0 0││0 0 0│。#└─┘└─┘。</p><p>现在，我们需要向第二个数组添加“它是否活着”的条件。只需使用原始数组即可轻松执行(&Amp；ing)。为了不中断我们的操作链，我们还将使用1(无操作)的第一个数组(&amp；amp；)：</p><p>放置current_gen。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(aa[-1，0，1]，&amp；：vRotate)。Reduce(&amp；：+)。Reduce(&amp；：+)。EQ(AA[3，4])。Zip(AA[1，current_gen]，&amp；：&amp；)#┌─┐┌─┐#│0 0 0││0 0 0│#│0 1 0 1 0││0 0 1 0 0│#│0 0 0││0 1 0 0 0│#│0 1 1 0 0││0 0 0│#│0 0 0││0 0 0│#。└─┘└─┘。</p><p>这里的#zip和上面的#product一样，几乎类似于Ruby的Array#zip，但也将提供的操作应用于每一对。</p><p>放置current_gen。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(aa[-1，0，1]，&amp；：vRotate)。Reduce(&amp；：+)。Reduce(&amp；：+)。EQ(AA[3，4])。Zip(AA[1，current_gen]，&amp；：&amp；)。Reduce(&amp；：|)#┌─┐#│0 0 0│#│0 1 1 1 0│#│0 1 0 0 0│#│0 1 1 0 0│#│0 0 0│#└─┘。</p><p>…。这几乎就是我们的最终答案，但它仍然是一个“内含数组的标量”，我们需要将其解开：</p><p>放置current_gen。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(aa[-1，0，1]，&amp；：vRotate)。Reduce(&amp；：+)。Reduce(&amp；：+)。EQ(AA[3，4])。Zip(AA[1，current_gen]，&amp；：&amp；)。Reduce(&amp；：|)。展开#0 0 0#0 1 1 1 0#0 1 0 0 0#0 1 1 0 0#0 0 0。</p><p>定义寿命(CURRENT_GEN)CURRENT_GEN。包起来。产品(aa[-1，0，1]，&amp；：hRotate)。产品(aa[-1，0，1]，&amp；：vRotate)。Reduce(&amp；：+)。Reduce(&amp；：+)。EQ(AA[3，4])。Zip(AA[1，current_gen]，&amp；：&amp；)。Reduce(&amp；：|)。展开末端。</p><p>Life←{↑1⍵∨.∧3 4=+/，‘1 0 1∘.⊖’1 0 1∘.⌽⊂⍵}。</p><p>def life(CURRENT_GEN)#LIFE←{--函数声明CURRENT_GEN#⍵--函数参数。包装#⊂--WRAP使其成为标量。产品(#∘.。--乘积AA[-1，0，1]，#‘1 0 1-1，0，1(是的，’1是-1)&amp；：h旋转)#⌽--h旋转。产品(#∘.。--product AA[-1，0，1]，#‘1 0 1&amp；：vRotate)#⊖--vRotate。Reduce(&amp；：+)。Reduce(&amp；：+)#+/，--Reduce两次？4.EQ(#=AA[3，4])#3。Zip(#--见下文？关于这3行AA[1，CURRENT_GEN]，#1⍵&amp；：&amp；)。Reduce(&amp；：|)#∨.∧。展开#↑--展开结束#}</p><p>«我做了两个简化：放弃了实现“一次减少两个级别”(两个减少就足够短了)，以及从相当复杂的APL的“内积”运算符(它接受两个函数，并将它们变成我用Zip+Reduce的常规Ruby表示的东西)。</p><p>最初的APL文章通过将Glider移动到10×10网格来演示其用法。我们试试这个吧。但首先，我们需要一种方法来显示这两个0和1，使它们看起来更漂亮一些。同样，借用APL：</p><p>def show(Grid)#APL风格的aa#valuesat(Aa)生成第一个数组中的项目数组，并使用第二个数组中的数字作为索引进行整形。将AA[&#39；&#39；，&#39；█&#39；]放入。(栅格)端点处的值_。</p><p>Glider=AA[1，1，1，1，0，0，0，0，1，0]。重塑(3，3)栅格=滑块。采用(-10，-10)显示栅格。WRAP#┌─┐#││#│█│#└─┘Generations=[GRID]9。乘以{世代&lt；&lt；生活(世代。last)}show AA[*GENERATIONS]#或者，更简单地，使用2.7的枚举器#产生：世代=枚举器。生产(栅格){|cur|寿命(Cur)}。取(10)。映射(&amp；：WRAP)显示AA[*层代]#┌─┐┌─┐┌─。─┐┌─┐#│。│#│#│█│#│。│█││█││██│#│█││█││██││█││██。│#│█││█││██││█│#│█││██││█│。│#│█│#└─┘└─。─┘└─┘</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://zverok.github.io/blog/2020-05-16-ruby-as-apl.html">https://zverok.github.io/blog/2020-05-16-ruby-as-apl.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ruby/">#ruby</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/apl/">#apl</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/life/">#life</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/数组/">#数组</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1002120.html"><img src="http://img.diglog.com/img/2020/5/thumb_c310b9d142a9902f8a81aab324549741.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002120.html">如何在Ruby中修复速度慢的代码</a></div><span class="my_story_list_date">2020-5-15 1:39</span></div><div class="col-sm"><div><a target="_blank" href="/story/1001547.html"><img src="http://img.diglog.com/img/2020/5/thumb_e5c947b7730c1c416fa0ef68131c8242.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001547.html">Ruby on Rails：WTF的五月</a></div><span class="my_story_list_date">2020-5-11 1:53</span></div><div class="col-sm"><div><a target="_blank" href="/story/1000694.html"><img src="http://img.diglog.com/img/2020/5/thumb_28b66f6c315af32dbb400eb656ea0fee.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1000694.html">铁路会议2020沙发版</a></div><span class="my_story_list_date">2020-5-5 12:2</span></div><div class="col-sm"><div><a target="_blank" href="/story/technology_internet_128854.html"><img src="http://img.diglog.com/img/2009/3/thumb_8817c1893a4d4bbbb2c04b14cd90c6bd.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/technology_internet_128854.html">开源软件大师Sam Ruby将离开IBM转投微软</a></div><span class="my_story_list_date">2009-3-5 11:34</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>