<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>无根容器</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">无根容器</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-31 21:04:59</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/5/c7ed5d5c578693ae0fd3279cd18f70cf.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>随着云计算的发展，容器继续变得越来越流行。我们实现容器的方式正在引入新的解决方案和想法。其中一个新想法是无根容器。</p><p>无根容器是一个新的容器概念，它不需要root权限即可制定。已经提出了许多解决方案来克服创建具有非特权用户的容器的技术挑战，其中一些仍在开发中，一些已经准备好投入生产。虽然无根容器呈现出一些优势，主要是从安全角度来看，但它们仍处于早期阶段。</p><p>在这篇文章中，第42单元研究员Aviv Sasson回顾了无根容器的内部结构。Aviv还提供了他在其中一个名为Slirp的主要无根网络组件中发现的漏洞。运行Prisma Cloud的Palo Alto Networks客户可通过主机和容器漏洞扫描程序保护其免受此漏洞的攻击，该扫描程序会对使用此漏洞运行的软件组件发出警报。</p><p>顾名思义，无根容器与传统容器相同，但不同之处在于它们不需要root特权即可形成。</p><p>如今，无根容器仍处于早期采用阶段，但已经得到该领域主要参与者的支持。</p><p>添加新的安全层。如果容器引擎、运行时或协调器受到危害，攻击者将不会获得主机上的root权限。</p><p>Linux内核中的一项新开发使此解决方案成为可能，它允许非特权用户创建新的用户名称空间。当用户创建并输入新的用户名称空间时，他将成为该名称空间上下文中的root用户，并获得生成正常运行的容器所需的大部分权限。</p><p>我不会深入研究用户命名空间的技术细节，但是在影响整个系统的区域中，命名空间根没有真正的根拥有特权(例如，命名空间根不能加载或删除内核模块)。这导致了由每个容器引擎以不同方式解决的一些挑战。</p><p>为了在容器内实现适当的联网，通常会创建一个虚拟以太网设备(Veth)并负责联网。这给无根容器带来了问题，因为只有真正的root才有权创建这样的设备。提出了许多解决方案来解决该问题-主要的解决方案是Slirp和LXC-User-NIC。</p><p>Slirp是一个广为人知的项目，最初主要用于QEMU(又名Quick Emulator)中的联网。经过一些修改后，它被调整为在无根容器中启用网络。它的工作方式是分叉到容器的用户和网络名称空间，并创建一个成为默认路由的分路设备。然后，它将设备的文件描述符传给在默认网络名称空间中运行的父设备，该父设备现在可以与容器和Internet进行通信。</p><p>设置网络的另一种方法是运行创建veth设备的setuid二进制文件。尽管它确实启用了容器内部的网络，但它忽略了无根容器的要点，因为它要求容器二进制文件以root权限运行。</p><p>实现容器的一个复杂元素是存储管理。默认情况下，容器引擎使用称为Overlay2(或Overlay)的特殊驱动程序来创建空间和性能都很高效的分层文件系统。使用无根容器不能做到这一点，因为大多数Linux发行版不允许在用户名称空间中挂载覆盖文件系统(Ubuntu是个例外)。这个问题驱使无根容器与其他驱动程序和文件系统一起工作。</p><p>显而易见的解决方案是使用另一个驱动程序，如VFS存储驱动程序。虽然它起作用了，但它的效率要低得多。更好的解决方案是创建一个新的存储驱动程序来满足无根容器的需要。一个这样的驱动器是FUSE-OverlayFS。它是Overlay的用户空间实现，比VFS更高效，并且可以在用户名称空间内运行。</p><p>Linux控制组(Cgroup)特性是实现容器的另一个关键元素，它允许将进程和容器组织成分层的组，然后可以限制和监视各种类型的资源的使用。由于内核的cgroups接口是通过伪文件系统提供的，该伪文件系统通常驻留在“/sys”(根拥有的目录)中，因此非root用户无法访问和使用它。</p><p>cgroup的新内核实现，支持将权限委派给非特权用户。缺点是V2不支持为cgroups V1实现的所有控制器(例如，DEVICES、NET_CLS、NET_PRIO等)。</p><p>LXC针对该问题的另一个解决方案是安装pam_cgfs.so，这是一个可插拔的身份验证模块(PAM模块)，允许非特权用户对cgroup进行身份验证和管理。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://unit42.paloaltonetworks.com/rootless-containers-the-next-trend-in-container-security/">https://unit42.paloaltonetworks.com/rootless-containers-the-next-trend-in-container-security/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/容器/">#容器</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/rootless/">#rootless</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>