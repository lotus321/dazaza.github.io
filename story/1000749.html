<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>骑虎：实施Istio的经验教训</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">骑虎：实施Istio的经验教训</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-05 20:57:12</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/5/3de4c811056d5c0ed3e61b6ef22fecb9.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>最近，我(和其他几个比我聪明得多的人)有机会用Istio实现了一个“真正的”生产系统，运行在托管的云提供的Kubernetes服务上。</p><p>Istio以难于构建和管理而闻名，但我没有读过多少关于试图让它发挥作用的战争故事，所以我想，对于一个试图实现这些东西的“典型”团队来说，真正写下战壕里的情况可能会很有用。我们的目的很大程度上不是要埋葬Istio，而是要赞扬它(它做了很多对“真正的”Kubernetes集群有用/必要的事情-如果不耐烦了就跳到最后)，同时警告那些即将填补漏洞的人，如果你没有准备好会发生什么。</p><p>简而言之，我希望在我们开始我们的“旅程”之前能找到一篇这样的文章。</p><p>当与其他技术相结合时，我们中没有人是Istio的有经验的实施者。作为研究的一部分，我们中的大多数人都有大约半年的Kubernetes工作经验，并在一次性集群上开发过不止几次Vanilla Istio。</p><p>每当我们遇到困惑、不确定或误解的障碍时，我们都会求助于通常的本地/友好/远程升级途径中的专业知识。</p><p>“当地”的道路是项目中的人。“友好的”道路是我们知道的社区中的人，他们是Istio专家(在Kubecon和类似的地方进行演讲)。一位这样的专家向我们承认，他们使用Linkerd“直到他们绝对需要Istio做点什么”，这让我们感到惊讶。“遥远”的道路主要是伊斯蒂奥论坛和伊斯蒂奥松弛频道。</p><p>每当我们互相伸出援手时，我们都会惊讶地发现，似乎很少有人在做我们正在做的事情。</p><p>这已经不是第一次了，因为库伯内斯我在想：我们不可能是世界上唯一想做这件事的人吧？&&#39；pic.twitter.com/cqFE0EQZj2(英语：http：//www.pic.twitter.com/cqFE0EQZj2/cqFE0EQZj2)</p><p>-Ian Miell(@ianmiell)2020年4月6日。</p><p>一个监控堆栈，我们实际上可以根据需要进行配置，而不需要只接受“非生产就绪”默认值。</p><p>也许我们是白痴，可以从纸袋中配置出一条路来，但它感觉，除了使用101个指南或接受默认设置之外，根本没有那么多现有的技术。</p><p>最终，我们让一切都按照我们想要的方式工作，但是我们在这个过程中消耗了大量的开发人员时间，并且在这个过程中不止一次几乎放弃了我们的努力。</p><p>我们通过关注博客和文档成功地进行了小型实验，受此鼓舞，我们乐观地尝试着跳过，让所有东西都能同时工作。幸运的是，我们使用完全GitOps的工作流运行了严格的管道，这意味着几乎没有什么“在我的集群上工作”的问题会减慢我们的速度(如果你不这样做，那就这么做吧)。它不一定要非常复杂才会非常有用)。</p><p>同样的问题：任何人都有解决方案吗？你：-想要mTLS打开-想要pod2pod通信工作并自动加密(可能主机被选中，因为pod IP不会被放入证书)尝试了许多看起来可能有效的东西，但不要。</p><p>-Ian Miell(@ianmiell)2020年4月9日。</p><p>监控就是一个很好的例子。如果您只是阅读文献，那么设置监控堆栈是轻而易举的事。在空服务器上运行默认的Istio安装，一切都是免费的。太棒了。然而，我们犯了一个错误，认为这意味着为了我们自己的目的摆弄这个堆栈相对容易。</p><p>首先，我们尝试使用严格的mTLS模式(这不是默认模式，原因非常充分)。然后，我们尝试让监控堆栈在单独的名称空间中运行。然后，我们试图通过严格的全球网络策略“全盘拒绝”来实现这一切。这三件事都造成了巨大的困惑，当它不是“只起作用”时，就会耗费数周的工程时间来解决问题。</p><p>结论是：当将Istio与其他Kubernetes技术一起使用时，不要低估更改默认值的难度。最好从简单开始，然后努力建立一个更全面的心理模型，为你的未来提供更好的服务。</p><p>如果你喜欢这本书，你可能会喜欢我的一本书：以艰难的方式学习打击以艰难的方式学习Git以艰难的方式学习Terraform。</p><p>Istio有很多在其他相关上下文中过载的术语。通常使用的术语，如“集群”或“注册表”，根据上下文的不同可能具有非常特定的含义或意义。这并不是Istio独有的疾病，而是文档的密度和必须嵌入到您的理解中的概念的数量，才能流畅地解析它们。</p><p>我们花了大量的时间来解读这些文献的段落，就像神学家在为死海古卷争论不休(“但是群集在这里意味着网格”、“不，它意味着进入Kubernetes群集”、“那是虚拟服务，而不是服务”、“无头服务与正常服务完全不同！”)。“。</p><p>入口网关描述了在网格边缘运行的负载均衡器，该均衡器接收传入的HTTP/TCP连接。它配置公开的端口、协议等，但与Kubernetes Inress Resources不同的是，它不包括任何流量路由配置。入口流量的流量路由改为使用Istio路由规则进行配置，其方式与内部服务请求完全相同。</p><p>我现在可以读到它，并且几乎可以理解它试图实时传达的信息。欺负我吧。现在想象一下，为了让他们帮你弄清楚一些事情，把它发送给一个不是完全精通网络的人，Kubernetes和Istio。就像项目中的某个人对我说的那样：“Istio Docs是很棒的…。如果你已经是一名Istio开发商的话。</p><p>顺便说一句，花点时间熟悉一下文档的结构是个好主意，因为尝试和定位自己很快就会变得令人抓狂：‘我之前看到的关于Inress TLS的那篇文章该死的在哪里？是在概念、设置、任务、示例、操作还是参考中？“</p><p>在开发Istio时，我们发现在一个版本中做不到的事情开始在另一个版本中工作，而我们正在调试它。</p><p>当我们谈到这个问题时，也要认真对待升级：我们做了一个看起来无伤大雅的升级，但有一些东西坏了，让系统停用了一天。所有信息都在那里，但在发布说明中很容易跳过。</p><p>伙计们，你付出什么就会得到什么，所以这应该是在一个更大的软件组件(Kubernetes)中运行的这样一组基本的软件组件(Istio)中应该预料到的！</p><p>如果您知道您将认真地使用Istio，请尽可能地抽出时间来提高您的调试技能。</p><p>不幸的是，文档有点分散，所以我们遇到了一些可能会有帮助的链接：</p><p>当你迷失在迷宫中时，很容易忘记Istio能给你带来什么力量和好处。</p><p>入口和出口控制、相互TLS(免费)、可观察性快速启动、流量整形…。名单还在继续。它的功能集是无与伦比的，它已经占据了市场份额，而且资金充足。我们不想放弃它，因为所有这些功能一举解决了无数需求。这些要求并不那么切合实际，所以这就是为什么我认为Istio短期内不会消失的原因。</p><p>这里真正的教训是，您不能逃避管理所有功能的复杂性，并期望能够随意操作和控制它，而不需要任何艰苦的工作。</p><p>相应地为它做预算，并投入必要的时间和精力来从骑老虎中获益。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://zwischenzugs.com/2020/05/05/riding-the-tiger-lessons-learned-implementing-istio/">https://zwischenzugs.com/2020/05/05/riding-the-tiger-lessons-learned-implementing-istio/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/实施/">#实施</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/tiger/">#tiger</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/istio/">#istio</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>