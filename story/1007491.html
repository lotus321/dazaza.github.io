<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>FlexBuffers</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">FlexBuffers</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-21 09:13:39</div><div class="page_narrow text-break page_content"><p>FlatBuffers是围绕架构设计的，因为当您希望获得最高性能和数据一致性时，强类型会很有帮助。</p><p>但是，有时您希望存储不符合架构的数据，因为您无法提前知道所有需要存储的内容。</p><p>为此，FlatBuffers有一种专用格式，称为FlexBuffers。这是一种二进制格式，可以与FlatBuffers结合使用(通过以FlexBuffers格式存储缓冲区的一部分)，也可以作为其自己的独立序列化格式。</p><p>虽然失去了强类型，但您保留了FlatBuffers相对于其他序列化格式(无论是否基于架构)的最独特优势：FlexBuffer也可以在不解析/复制/对象分配的情况下访问。这在效率/内存友好性方面是一个巨大的胜利，并且允许独特的用例，例如映射大量自由格式的数据。</p><p>FlexBuffers的设计和实现允许非常紧凑的编码，将字符串的自动池化与容器的自动大小调整相结合，以尽可能小的表示形式(8/16/32/64位)。许多值和偏移量可以仅用8比特编码。尽管由于需要自描述，无模式表示通常更庞大，但在许多情况下，FlexBuffers生成的二进制文件比常规的FlatBuffer要小。</p><p>不过，FlexBuffers仍然比普通的FlatBuffer慢，所以我们建议您只在需要时才使用它。</p><p>您可以创建任何值，然后是Finish。与要求根值为表的FlatBuffers不同，这里的任何值都可以是根，包括一个单独的int值。</p><p>现在可以访问包含fbb.GetBuffer()形式的编码值的std：：Vector&lt；uint8_t&gt；。写入、发送或存储在父FlatBuffer中。在本例中，缓冲区大小仅为3字节。</p><p>FlexBuffers只存储所需大小的整数，因此它不区分不同大小的整数。您可以要求64位版本，无论您放入的是什么。事实上，由于您要求将根作为整数读取，如果您提供的缓冲区实际上包含一个浮点数或其中包含数字的字符串，它也会动态地为您转换它，或者如果可以，则返回0。如果您实际上想在访问缓冲区之前知道缓冲区中的内容，则可以调用root.GetType()或root.IsInt()等。</p><p>它存储等同于JSON值{vec：[-100，&#34；Fred&#34；，4.0]，foo：100}。根是一个只有两个键-值对的字典，键是vec和foo。与FlatBuffers不同的是，它实际上必须将这些键存储在缓冲区中(如果您存储多个这样的对象，则通过池化键值，它只会这样做一次)，但与FlatBuffers不同的是，它对您使用的键(字段)没有限制。</p><p>map构造函数使用C++11Lambda对其子级进行分组，但如果您愿意，也可以使用更常规的开始/结束调用。</p><p>贴图中的第一个值是向量。您将注意到，与FlatBuffer不同，您可以使用混合类型。还有一个TypedVector变体，它只允许单一类型，并且使用的内存更少。</p><p>IndirectFloat是一个有趣的特性，它允许您按偏移量而不是内联存储值。虽然这不会对用户造成任何明显的更改，但其结果是多次出现的大值(特别是双精度或64位整数)可以共享(参见ReuseValue)。另一种用例是在向量内部，其中最大的元素构成所有元素的大小(例如，单个双精度型强制所有元素为64位)，因此如果双精度型是间接的，则将大量小整数与双精度型一起存储会更高效。</p><p>要创建相同JSON{vec：[-100，&#34；fred&#34；，4.0]，foo：100}的等价物，可以使用以下代码：</p><p>将生成一个特殊的访问器，允许您直接访问根值，例如a_flebuffer_root().AsInt64()。</p><p>矢量通常比贴图效率高得多，所以对于小对象，如果可能的话，首选矢量而不是贴图。使用向量而不是具有关键点x、y和z的贴图。更好的做法是使用类型化向量。或者更好的做法是使用固定大小的类型向量。</p><p>贴图向后兼容向量，因此可以进行迭代。您可以只迭代值(map.Values())，也可以与键向量(map.Keys())并行迭代。如果您打算访问大多数或所有元素，这比按键查找每个元素要快，因为这涉及对键向量进行二进制搜索。</p><p>如果可能，不要将需要大位宽(如DOUBLE)的值混合到由较小值组成的大矢量中，因为所有元素都将采用此宽度。如果可能出现这种情况，请使用IndirectDouble。请注意，整数会自动使用尽可能小的宽度，也就是说，如果您要求序列化其值实际上很小的int64_t，您将使用更少的位。只要有可能，双精度数就会无损地表示为浮点数，但这只对少数几个值是可能的。由于嵌套向量/贴图存储在偏移上，因此它们通常不会影响向量宽度。</p><p>要存储大型字节数据数组，请使用BLOB。如果您使用类型化的向量，Size字段的位宽可能会使其占用比预期更多的空间，并且可能与memcpy不兼容。类似地，如果(U)int16_t的大型数组的大小可以超过64k元素，那么将其存储为二进制blob可能会更好。构造和使用在其他方面类似于字符串。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://google.github.io/flatbuffers/flexbuffers.html">https://google.github.io/flatbuffers/flexbuffers.html</a></div><div class="story_tags page_narrow"></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>