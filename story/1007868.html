<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>一个疯狂的漏洞：20世纪70年代英特尔8271磁盘芯片吃掉了我的数据</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">一个疯狂的漏洞：20世纪70年代英特尔8271磁盘芯片吃掉了我的数据</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-24 05:37:24</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/6/e81ba3fef9c2a2bb73dc11310db5e0c6.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>如果你一定要遭受数据丢失的痛苦，那么至少要确保你从这次经历中收集了一个好故事！最近，我一直喜欢通过玩复古的软件和硬件来保持我内在的工程师的敏锐。我对BBC Micro的软盘驱动器和老式软盘保护特别感兴趣。BBC Micro有两个不同的流行软驱控制器：较旧的Intel8271和较新的Western Digital 1770/1772。这两个控制器具有不同的功能，并且按桶负载计算异常！</p><p>我的数据丢失是在试验Intel8271时发生的，Intel8271是20世纪70年代的芯片和设计。它的尺寸很好，穿起来有点热。</p><p>互联网上关于这种芯片的信息不多，但有一份相当不错的数据表，其中包括关于复位寄存器的描述：</p><p>毫无疑问，正是我的安全背景促使我阅读此说明，然后立即将值100(而不是1或0)写入此寄存器。</p><p>正是在这一点上，我的驱动力着魔了。重试表明，仅通过写入值4来设置位D2就足以引起恶魔感染：</p><p>不同的驱动器行为不同。这个驱动器，一个较老的单头Chinon F-051MD似乎激活了它的所有部件：头部剧烈摆动，马达有时旋转。我的新款三菱驱动器发出可怕的、可怕的高音尖叫声。这是我最喜欢的硬盘，我不想再听到那种声音，所以没有视频。</p><p>这就是事情变得疯狂的地方：当我第一次这样做的时候，我的Chinon驱动器中有一张光盘，驱动器上的数据变成了烤面包……。尽管存在硬件写保护选项卡。</p><p>确实如此。这够离奇的了，值得一查！当恶作剧出现时，软驱会收到什么信号？提醒一下，BBC Micro使用的是Shugart风格(不是PC风格！)。与驱动器的连接：</p><p>从控制器到驱动器，我们有Select 0、Select 1、Not DIR(步骤方向)、针脚20(步骤；在上面的维修手册图表中没有标注)、Write/Data(写入/数据)、Write/Enable(写入/启用)、Side/SELECT(侧/选择)。要对其中几个进行采样，请执行以下操作：</p><p>从控制器到驱动器的其他针脚上也有类似的信号--它们不正常！以375 kHz的频率打开和关闭马达并不是预期的控制器行为，甚至可能对马达不利；我不知道。</p><p>光盘损坏来自上面写使能引脚上的异常信号。这就是控制器请求驱动器为其写头加电的方式，并且驱动器被要求以300+kHz的频率这样做。在步进和步进方向销上也有这些疯狂的信号之一，所以驱动器在被要求激活写头的同时，在整个磁道范围内都在寻找。不太好。</p><p>对我们来说，这里的控制器出错可能是合理的。在数据手册第8-124页的写保护标题下，显示当此输入引脚有效时，8271将不会写入磁盘。当驱动器发出写保护信号时，此合同明显被违反。</p><p>但这里面还有更多的东西！大多数软驱也有最后一道防线。例如，我的Mitubishi MF503B驱动器的应用笔记清楚地指出&#34；当写保护磁盘插入驱动器时，此信号变为‘0’。即使写入门处于活动状态，写入也会被禁止。&#34；我的Chinon驱动器似乎在大多数情况下都是正确的，但在存在剧烈振荡信号的情况下却并非如此。似乎存在竞争条件(如果在写使能门已经激活的情况下选择了驱动器)，其中在注意到写保护条件之前，将有一位电流流过写头。</p><p>互联网上没有太多关于英特尔8271的信息。这是一个稍老一点的软盘控制器芯片，产于20世纪70年代。它的一些功能暗示了80年代已经退役的设计品味和方向。例如，芯片能够使用主机存储器DMA在磁盘扇区内异步扫描任意字节字符串。也许是大型机时代的遗物？英国广播公司的微型机没有使用它。DMA功能根本没有连线。</p><p>据我所知，上世纪80年代没有其他家用电脑使用过8271。有充分的理由不这么做。可能最重要的是，8271不支持双密度(又名)。MFM，西部数据1770/1772年就是这样做的。因此，使用8271会降低存储容量。尽管1770年的机器变得很普遍，BBC Micro仍然忍受着这种轰动。商业软件需要在所有机器上运行，包括基于8271的机器。</p><p>我怀疑8271可能是基于Intel MCS-48微控制器。有几件事是一致的，比如设计和制造的日期。但在提供的API中也有线索。&#34；读/写特殊寄存器&#34；命令特别有用：</p><p>如您所见，有很多特殊的寄存器，只有相当少的几个记录在案。记录的最高索引为0x22，或十进制为34。</p><p>一种理论是读/写专用寄存器简单地读取或写入存在于8048(或变体)中的64字节RAM中的一个。有大量证据表明，大多数特殊的寄存器索引似乎都有作用。例如，寻道和建立时序参数最终保存在特殊寄存器0x0D和0x0E中，即使在任何地方都没有记录。同样未记录的0x1D似乎是正式数据寄存器的镜像。诸若此类。</p><p>如果8048理论成立，也许复位寄存器的未记录和疯狂位对应于测试模式之一，单步模式或外部存储器访问模式？</p><p>如果您对8271的实际架构有任何了解或记忆，或者有未记录行为的详细信息，请与我们联系！</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://scarybeastsecurity.blogspot.com/2020/06/a-wild-bug-1970s-intel-8271-disc-chip.html">https://scarybeastsecurity.blogspot.com/2020/06/a-wild-bug-1970s-intel-8271-disc-chip.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/漏洞/">#漏洞</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/芯片/">#芯片</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/英特尔/">#英特尔</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/chip/">#chip</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/驱动器/">#驱动器</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1007673.html"><img src="http://img.diglog.com/img/2020/6/thumb_640c8f055f248f635730f4686b5e12e0.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007673.html">NETGEAR零日允许完全接管数十个路由器型号</a></div><span class="my_story_list_date">2020-6-23 1:52</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007090.html"><img src="http://img.diglog.com/img/2020/6/thumb_33231f19fcf9066ca9ea5cb2f292fe32.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007090.html">对谷歌Chrome用户的大规模间谍活动显示出新的安全漏洞</a></div><span class="my_story_list_date">2020-6-18 22:1</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007062.html"><img src="http://img.diglog.com/img/2020/6/thumb_33231f19fcf9066ca9ea5cb2f292fe32.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007062.html">对谷歌Chrome用户的大规模间谍活动显示出新的安全漏洞</a></div><span class="my_story_list_date">2020-6-18 14:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1006864.html"><img src="http://img.diglog.com/img/2020/6/thumb_4f76873163993caa3503fb4b4fd2410f.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006864.html">涟漪2.0：供应链放大了19个零日漏洞</a></div><span class="my_story_list_date">2020-6-17 4:48</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>