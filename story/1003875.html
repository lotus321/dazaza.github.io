<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>通过构建CLI应用程序深入了解Go</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">通过构建CLI应用程序深入了解Go</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-27 08:52:32</div><div class="page_narrow text-break page_content"><p>您已经了解了GO语法，并逐个进行了练习，但是，除非您构建了一个应用程序，否则在GO中编写应用程序会让您感到不舒服。</p><p>在这篇博客文章中，我们将在GO中构建一个CLI应用程序，我们将其称为go-Grab-xkc.该应用程序从XKCD获取漫画，并通过命令行参数为您提供各种选项。</p><p>我们将不使用外部依赖项，并且将只使用Go标准库构建整个应用程序。</p><p>这个应用程序的想法看起来很愚蠢，但其目的是在Go中轻松地编写产品(某种)代码，而不是被Google收购。</p><p>注意：这篇文章假设读者熟悉围棋语法和术语，介于初学者和中级之间。</p><p>$go-Grab-xkcd--help Go-Grab-xkcd的用法：-n int Comic Number to Fetch(默认最新)-o String打印输出格式：text/json(默认值&#34；text&#34；)-s将图像保存到当前目录-t int客户端超时(以秒为单位)(默认值30)。</p><p>$go-grab-xkcd-n 323标题：鲍尔默巅峰漫画编号：323日期：1-10-2007描述：苹果使用自动烈性酒IV。图片：https://imgs.xkcd.com/comics/ballmer_peak.png。</p><p>$go-Grab-xkcd-n 323-o json{&#34；Title&#34；：&#34；Ballmer Peak&#34；，&#34；：323，&#34；Date&#34；：&#34；1-10-2007&#34；，&#34；Description&#34；：&#34；：&#34；Apple使用自动烈性酒IV.&#34；，&#34；image&#34；：&#34；https://imgs.xkcd.com/comics/ballmer_peak.png&#34；}</p><p>您可以通过下载并运行适用于您计算机的应用程序来尝试其余选项。</p><p>本教程结束后，您将熟悉以下主题-。</p><p>$TREE go-Grab-xkcdgo-Grab-xkcd├──Client│└──xkcd.go└──model└──comic.go├──main.go└──go.mod。</p><p>xkcd.go-用于对API进行HTTP调用、解析响应并保存到磁盘的xkcd客户端。</p><p>xkcd非常棒，您不需要任何注册或访问密钥就可以使用他们的API。打开xkcd API“文档”，您会发现有2个端点-。</p><p>{&#34；数字&#34；：2311，&#34；月&#34；：&#34；5&#34；，&#34；天&#34；：&#34；25&#34；，&#34；年份&#34；：&#34；2020&#34；，&#34；标题&#34；：&#34；置信区间&#34；，&#34；Alt&#34；：&#34；最糟糕的部分是&#39；的毫西格玛间隔。&#34；，&#34；img&#34；：&#34；https://imgs.xkcd.com/comics/confidence_interval.png&#34；，&#34；SAFE_TITLE&34；：&#34；置信区间&#34；，&#34；链接&#34；：&#34；&#34；，&#34；新闻&#34；：&#34；&#34；，&#34；文字记录&#34；：&#34；&#34；}。</p><p>基于上面的JSON响应，我们在comic.go模型包中创建了一个名为ComicResponse的结构。</p><p>输入ComicResponse struct{月字符串`json：&#34；月&#34；`num int`json：&#34；num&#34；`链接字符串`json：&#34；link&#34；`年份字符串`json：&#34；年&#34；`新闻字符串`json：&#34；news&#34；`安全标题字符串`json：&#34；Safe_Title&#34；`文本字符串`json：&&。img&#34；`标题字符串`json：&#34；title&#34；`日字符串`json：&#34；day&#34；`}</p><p>类型Comic struct{title string`json：&#34；title&#34；`number int`json：&#34；number&#34；`date string`json：&#34；date&#34；`description string`json：&#34；description&#34；`Image string`json：&#34；image&#34；`}。</p><p>//FormattedDate将各个Date元素格式化为单个字符串函数(Cr ComicResponse)FormattedDate()string{return fmt。Sprintf(&#34；%s-%s-%s&#34；，cr。日期，cr.。月，cr.。年份)}。</p><p>//Comic将我们从API接收到的ComicResponse转换为应用程序的输出格式Comic func(Cr ComicResponse)Comic()Comic{return Comic{title：cr。标题，编号：cr。编号，日期：Cr。FormattedDate()，描述：cr。Alt，图像：Cr。img，}}。</p><p>//PrettyString创建Comic的漂亮字符串，我们将使用该字符串作为输出函数(C Comic)PrettyString()string{p：=fmt。Sprintf(&#34；标题：%s\n漫画编号：%d\n日期：%s\n描述：%s\n图像：%s\n&#34；，c..。标题，c。编号，c。日期，c.。描述，c.。图像)返回p}。</p><p>//JSON将Comic结构转换为JSON，我们将使用JSON字符串作为输出函数(C Comic)JSON()字符串{cJSON，err：=json。Marshal(C)if err！=nil{return&#34；&#34；}return string(CJSON)}。</p><p>const(//xkcd BaseURL String=&#34；https://xkcd.com&#34；//DefaultClientTimeout是取消请求前等待的时间DefaultClientTimeout时间。持续时间=30*时间。Second//LatestComic是xkcd接口LatestComic ComicNumber=0中最新的漫画号。</p><p>//XKCDClient是XKCD类型XKCDClient struct{client*http.。client baseURL string}//NewXKCDClient创建一个新的XKCDClient函数NewXKCDClient()*XKCDClient{return&amp；XKCDClient{client：&amp；http。客户端{timeout：DefaultClientTimeout，}，baseURL：BaseURL，}}。</p><p>//FETCH按照提供的漫画号函数FUNC(HC*XKCDClient)FETCH(n ComicNumber，save bool)(model.。漫画，错误){对应，错误：=hc。客户。GET(HC.。buildURL(N))如果err！=nil{返回模型。漫画{}，错误}分别推迟。身体。Close()var comicResp模型。如果err：=json，则返回ComicResponse。NewDecoder(分别为。身体)。DECODE(&amp；comicResp)；err！=nil{返回模型。comic{}，err}if save{if err：=hc。SaveToDisk(comicResp.。img，&#34；.&#34；)；err！=nil{fmt.。Println(&#34；无法保存图像！&#34；)}}返回comicResp。comic()，无}</p><p>//SaveToDisk下载并保存漫画本地函数(HC*XKCDClient)SaveToDisk(url，savePath string)error{resp，err：=http。如果err！=nil{return err}延迟响应，则GET(Url)。身体。Close()disSavePath，_：=文件路径。ABS(SavePath)filePath：=fmt。Sprintf(&#34；%s/%s&#34；，disSavePath，路径。base(Url))文件，err：=os。如果err！=nil{return err}延迟文件，则创建(FilePath)。CLOSE()_，ERR=io。复制(文件，分别。正文)if err！=nil{return err}return nil}。</p><p>func(HC*XKCDClient)buildURL(N ComicNumber)string{var finalURL string if n==LatestComic{finalURL=fmt.。Sprintf(&#34；%s/info.0.json&#34；，hc。baseURL)}Else{finalURL=fmt。Sprintf(&#34；%s/%d/info.0.json&#34；，hc。baseURL，n)}返回finalURL}。</p><p>漫画号：=旗帜。int(&#34；n&#34；，int(客户端。LatestComic)，&#34；要获取的漫画号(默认最新)&#34；，)clientTimeout：=flag。Int64(&#34；t&#34；，int64(客户端。DefaultClientTimeout。秒())，&#34；客户端超时(秒)&#34；，)saveImage：=flag。bool(&#34；s&#34；，false，&#34；将图像保存到当前目录&#34；，)outputType：=flag。字符串(&#34；o&#34；，&#34；text&#34；，&#34；打印输出格式：text/json&#34；，)标志。parse()。</p><p>上面的shell代码简单地调用了for循环中的go-Grab-xkcd命令，由于xkcd使用序列整数作为漫画号/ID，因此i值被替换为漫画号。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://eryb.space/2020/05/27/diving-into-go-by-building-a-cli-application.html">https://eryb.space/2020/05/27/diving-into-go-by-building-a-cli-application.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/cli/">#cli</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/building/">#building</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/xkcd/">#xkcd</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1003866.html"><img src="http://img.diglog.com/img/2020/5/thumb_5e85ac2cc897d9caf2839ac90b5ea726.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003866.html">苹果协助授权维修店支付COVID相关费用</a></div><span class="my_story_list_date">2020-5-27 7:32</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003821.html"><img src="http://img.diglog.com/img/2020/5/thumb_197dfbc57ca8905594612a7569f4fa7c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003821.html">印度政府开源Aarogya Setu-其COVID19跟踪应用</a></div><span class="my_story_list_date">2020-5-27 3:37</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003811.html"><img src="http://img.diglog.com/img/2020/5/thumb_99ef21b9af0703a196d1dc1fbbeeb6ef.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003811.html">Play Store上有一个假的Dark Sky应用程序-人们正在支付真金白银</a></div><span class="my_story_list_date">2020-5-27 2:47</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003807.html"><img src="http://img.diglog.com/img/2020/5/thumb_54b432ec5b1fd71c9629b1e7941a5dfb.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003807.html">菲格玛的故事--泰尔奖学金申请</a></div><span class="my_story_list_date">2020-5-27 2:30</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>