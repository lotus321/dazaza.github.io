<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>无服务器灯堆</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">无服务器灯堆</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-15 00:58:04</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/6/59f86cf74ccf11b3ad386227d5bad277.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>这是面向PHP开发人员的系列帖子中的第一篇。本系列将解释如何在PHP中使用无服务器技术。它涵盖了构建无服务器应用程序的可用工具、框架和策略，以及为什么现在是开始的合适时机。</p><p>在以后的文章中，我将演示如何将AWS Lambda用于使用Laravel和Symfony等PHP框架构建的Web应用程序。我展示了如何从使用Lambda作为web托管功能的替代品转向解耦的、事件驱动的方法。我将介绍如何将范围最小的多个Lambda函数与其他无服务器服务相结合，以创建高性能、可伸缩的微服务。</p><p>在这篇文章中，您将学习如何通过自定义运行时API在Lambda中使用PHP。请访问此GitHub存储库获取示例代码。</p><p>可伸缩性是传统LAMP堆栈固有的挑战。可伸缩的应用程序是可以处理高度可变的流量级别的应用程序。PHP应用程序通常通过根据需要添加更多Web服务器来水平扩展。这是通过负载均衡器进行管理的，负载均衡器将请求定向到各种Web服务器。每增加一台服务器都会带来额外的网络、管理、存储容量、备份和恢复系统以及资产管理库存更新方面的开销。此外，每个水平扩展的服务器都独立运行。这可能会导致配置同步挑战。</p><p>新的存储挑战出现了，因为每台服务器都有自己的磁盘和文件系统，通常需要开发人员添加一种机制来处理用户会话。使用无服务器技术，可以为开发人员管理可伸缩性。</p><p>如果流量激增，服务可以扩展以满足需求，而无需部署额外的服务器。这使得应用程序可以快速从原型过渡到生产。</p><p>对动态内容的所有请求(除/Assets/*以外的任何内容)都会转发到Amazon API Gateway。这是一个完全托管的服务，用于创建、发布和保护任何规模的API。它充当PHP应用程序的“前门”，将请求向下路由到Lambda函数。Lambda函数包含业务逻辑以及与MySQL数据库的交互。您可以将输入作为请求头、路径变量、查询字符串参数和正文的任意组合传递给Lambda函数。</p><p>在Re：Invent2017期间，AWS发布了Aurora Serverless，这是一种按需无服务器关系数据库，采用按使用付费模式。这为开发人员管理提供和扩展关系数据库的责任。</p><p>在Re：Invent2018上，AWS宣布了两项新的Lambda功能。这些使开发人员能够构建自定义运行时，并在函数之间共享和管理公共代码。</p><p>2019年9月，AWS宣布对私有网络内Lambda功能的冷启动进行了重大改进，从而提高了功能启动性能，提高了弹性网络接口的使用效率，减少了VPC冷启动。</p><p>在Re：Invent2019年，AWS宣布推出一项名为Amazon RDS Proxy的新服务。位于应用程序和关系数据库之间的完全托管数据库代理。它高效地汇集和共享数据库连接，以提高应用程序的可伸缩性。</p><p>将这些服务组合在一起，可以使用PHP和关系数据库构建安全、高效、可伸缩的无服务器应用程序。</p><p>自定义运行时API是一个简单的接口，用于支持以任何编程语言或特定语言版本执行Lambda函数。自定义运行时API需要一个称为引导的可执行文本文件。引导文件负责代码和Lambda环境之间的通信。</p><p>要创建自定义运行时，您必须首先在与Lambda执行环境兼容的Amazon Linux环境中编译所需版本的PHP。要执行此操作，请按照以下分步说明进行操作。</p><p>下面的文件是一个基本PHP引导文件的示例。此示例用于说明目的，因为没有发生错误处理或抽象。要确保正确处理异常，请在构建生产自定义运行时参考运行时API文档。</p><p>#！/opt/bin/php&lt；？PHP//这将调用Composer的自动加载器，这样我们就可以使用GUZZE和任何其他我们需要的第三方库。需要__DIR__。&#39；/vendor/autoload.php；//这是请求处理循环。除非出现不可恢复的故障，否则此循环将一直运行，直到环境关闭。do{//向运行时API请求要处理的请求。$request=getNextRequest()；//从_HANDLER环境变量获取函数名称，并确保函数的代码可用。$handlerFunction=ARRAY_SLICE(EXPLODE(&#39；.&#39；，$_ENV[&#39；_HANDLER&#39；])，-1)[0]；REQUIRED_ONCE$_ENV[&#39；LAMBDA_TASK_ROOT&#39；]。&#39；/src/&#39；。$handlerFunction。&#39；.php；//执行所需函数并获取响应。$Response=$handlerFunction($request[&#39；payload&#39；])；//将响应提交回运行时接口。sendResponse($request[&#39；invocationId&#39；]，$Response)；}While(TRUE)；函数getNextRequest(){$Client=NEW\GuzzleHttp\Client()；$Response=$Client-&gt；GET(&#39；http://&#39；。$_ENV[&#39；AWS_Lambda_Runtime_API&#39；]。&#39；/2018-06-01/runtime/invocation/next&#39；)；返回[&#39；invocationId&#39；=&gt；$response-&gt；getHeader(&#39；Lambda-Runtime-Aws-Request-Id&#39；)[0]，&#39；有效负载&#39；=&gt；json_decode((String)$Response-&gt；getBody()，true)]；}函数sendResponse($invocationId，$Response){$Client=NEW\GuzzleHttp\Client()；$Client-&gt；发布(&#39；http://&#39；。$_ENV[&#39；AWS_Lambda_Runtime_API&#39；]。&#39；/2018-06-01/运行时/调用/&#39；。$invocationId。&#39；/Response&#39；，[&#39；Body&#39；=&gt；$Response])；}</p><p>#！/opt/bin/php声明指示程序加载器使用为Amazon Linux编译的PHP二进制文件。</p><p>按照以下步骤将引导包和编译后的PHP二进制文件打包成`runtime.zip`。</p><p>运行时引导使用基于HTTP的本地接口。这将检索每个Lambda函数调用的事件有效负载，并返回函数的响应。此引导文件使用非常流行的PHP HTTP客户端GUZLE向自定义运行时API发出请求。GUZLE软件包是使用Composer软件包管理器安装的。以这种方式安装包创建了一种机制，用于随着应用程序的发展合并其他库和依赖项。</p><p>Lambda层提供了一种集中管理跨多个功能共享的代码和数据的机制。当Lambda函数配置了层时，层的内容会放入执行环境的/opt目录中。您可以在函数的部署包中包含自定义运行时，也可以将其作为层包含。Lambda执行部署包中的引导文件(如果可用)。如果没有，Lambda将在函数层中查找运行时。目前有几个开放源码PHP运行时层可用，最值得注意的是：</p><p>以下步骤展示了如何将之前创建的`runtime.zip`和`vendor.zip`二进制文件发布到Lambda层，并使用它们通过PHP运行时构建Lambda函数：</p><p>使用AWS命令行界面(CLI)发布先前创建的二进制文件中的图层。</p><p>记下每个命令的LayerVersionArn输出值(例如，下一步需要使用的arn:aws:lambda:eu-west-1:XXXXXXXXXXXX:layer:PHP-example-runtime:1)，)。</p><p>您可以通过AWS CLI、AWS无服务器应用程序模型(SAM)或直接在AWS管理控制台中创建Lambda函数。要使用控制台执行此操作，请执行以下操作：</p><p>在Function Name字段中输入“PHPHello”，然后在Runtime字段中选择Provide Your Our Bootstrap。然后选择创建函数。</p><p>选择提供层版本ARN，然后将步骤1中的自定义运行时层的ARN复制并粘贴到层版本ARN字段中。</p><p>在function Code部分，创建一个名为src的新文件夹，并在其中创建一个名为index.php的新文件。</p><p>在处理程序输入字段中插入“index”。这将指示Lambda在调用时运行索引函数。</p><p>选择页面右上角的Test，在Event Name字段中输入“PHPTest”。在事件有效负载字段中输入以下内容，然后选择创建：{&#34；name&#34；：&#34；world&#34；}。</p><p>您可以看到，事件负载“name”值用于返回“hello world”。它取自提供给lambda函数的$data[&#39；name&#39；]参数。日志输出提供有关用于执行代码的实际持续时间、计费持续时间和内存量的详细信息。</p><p>这篇文章解释了如何使用Lambda层和自定义运行时API在PHP运行时创建Lambda函数。它介绍了可随应用流量扩展的无服务器LAMP堆栈的架构。</p><p>Lambda允许具有混合运行时的函数相互交互。现在，PHP开发人员可以加入其他专注于交付代码的无服务器开发团队。有了无服务器技术，您不再需要考虑重启网络主机、扩展或托管。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://aws.amazon.com/blogs/compute/introducing-the-new-serverless-lamp-stack/">https://aws.amazon.com/blogs/compute/introducing-the-new-serverless-lamp-stack/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/服务器/">#服务器</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/lamp/">#lamp</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/php/">#php</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1005527.html"><img src="http://img.diglog.com/img/2020/6/thumb_466ec853fb03d671bc170daff21be0f8.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005527.html">Rust中从头开始编写DNS服务器的指南</a></div><span class="my_story_list_date">2020-6-7 12:21</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005417.html"><img src="http://img.diglog.com/img/2020/6/thumb_8122e745ceae3935cb742a74c1b8bac6.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005417.html">简单、简约的服务器仪表板</a></div><span class="my_story_list_date">2020-6-6 17:8</span></div><div class="col-sm"><div><a target="_blank" href="/story/1004022.html"><img src="http://img.diglog.com/img/2020/5/thumb_3c7849d7452c90b8aaf223885c544fe9.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1004022.html">无服务器Express</a></div><span class="my_story_list_date">2020-5-28 10:56</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003680.html"><img src="http://img.diglog.com/img/2020/5/thumb_1fb6a69fd2d506e6dcdae7a97a49fff4.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003680.html">数以千计的企业系统被新的蓝色知更鸟恶意软件团伙感染</a></div><span class="my_story_list_date">2020-5-25 20:55</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>