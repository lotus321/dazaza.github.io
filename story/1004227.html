<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用QEMU模拟CUPS的旧式打印机驱动程序</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用QEMU模拟CUPS的旧式打印机驱动程序</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-29 20:32:19</div><div class="page_narrow text-break page_content"><p>在本指南中，我将解释如何在ARM-Linux上设置CUPS网络打印服务器，该服务器仍然可以使用针对其他体系结构的旧打印机驱动程序或已停产的打印机驱动程序，使用Docker with QEMU平台仿真。因此，例如，我们可以使用ARM服务器容器内模拟的32位Linux打印机驱动程序。在我的示例中，我将设置一台Dell 1250c打印机，但它也应该可以与其他设备配合使用。</p><p>有很长一段时间，我在家里使用Dell 1250c打印机，连接到运行OpenWRT的TP-Link路由器，作为简单的网络打印解决方案。使用此设置，只要客户端操作系统仍然支持旧式和专有戴尔驱动程序，我就可以从本地网络中的每台计算机进行打印。</p><p>很快，我想用我自己的家庭服务器取代TP-Link路由器，这是一台运行ArchLInux的小型廉价的ARM计算机。即使在这个平台上使用CUPS安装和配置打印服务器也很容易，但是需要开放源码的打印驱动程序。戴尔官方仅对此设备的Windows和MacOS提供有限的驱动程序支持。2011年起，Xerox Phaser 6000的备用驱动程序与此戴尔打印机兼容，支持Linux，但仅限于32位PC体系结构。我不能在我的手臂平台上使用它。</p><p>因此，我必须以某种方式使用CUPS和ARM板上的打印驱动程序“模拟”32/64位环境，才能再次使用这台打印机。我使用QEMU和Docker实现了这一点，使用的是试验性的、鲜为人知的容器配置。</p><p>在ARM板上，安装Docker并引导名为ArchLInux-cupsd的x64 ArchLInux容器。我们还需要AUR包qemu-user-static-bin。以下命令在ArchLInux ARM上进行了测试，但原则上安装程序应该也可以在其他发行版上运行。</p><p>Pacman-S docker qemu-user-static-bingpasswd-a picout dockersystemctl enable--now dockerDOCKER_CLI_ENTIFICATION=enable docker run--特权\-v/dev/bus/usb/：/dev/bus/usb/\-p 631：631\-dit\--始终重新启动\-entry point/usr/bin/cupsd\--name ArchLInux-cupsd--Platform Linux。</p><p>Docker和容器将在引导时自动启动，并将CUPS配置和网络打印端口631转发到主机。请确保在防火墙上打开此端口。</p><p>最后一个命令将在容器内生成一个shell。我们现在将安装CUPS守护程序和专有打印驱动程序。根据驱动程序的不同，您必须向包管理器添加自定义存储库。</p><p>除了安装依赖项之外，我们还将设置root密码，因为稍后我们将在CUPS Web管理界面中使用它。</p><p>启动CUPS打印服务器之前，请修改配置文件以允许远程访问。下面的示例在网络安全方面非常宽松，因此您可能需要根据需要进行更改。</p><p>[.]侦听0.0.0.0：631[.]#限制对服务器的访问.&lt；location/&&gt;order Allow，Deny Allow all&lt；/location&&gt;#限制对管理页面的访问.&lt；location/admin&&gt;order Allow，Deny Allow all&lt；/location&&gt;[.]。</p><p>检查容器内是否可以识别您的USB连接的打印机，并检查权限是否正确。</p><p>现在，您可以通过https://&lt；YOUR_SERVER_IP&gt；：631/admin/上的Web配置界面照常设置打印机(使用打印服务器的本地IP地址)。旧式打印机驱动程序也应该可用且工作正常。</p><p>在最后一步中，我们将配置Avahi，这是一个将我们的网络打印机通告给本地网络的守护进程。我猜CUPS可以和Avahi一起运行得很好，但是在Docker中没有Systemd支持(在Podman中也没有多平台支持)，在容器中同时运行就有点复杂了。因此，我决定在主机系统本身的Docker容器之外运行Avahi。</p><p>创建以下avahi-service文件，但一定要替换以下部分：name、rp、ty、adminurl和note。部分adminurl非常重要，它将与CUPS使用的内部打印机名称相对应。转到https://&lt；YOUR_SERVER_IP&gt；：631/printers/，，单击您配置的打印机并记下打印机名称。</p><p>standalone=&#39；no&#39；？&gt；&lt；！--*-nxml-*--&gt；&lt；！DOCTYPE服务组系统&#34；avahi-service.dtd&#34；&gt；&lt；service-group&gt；&lt；名称&gt；/名称&gt；服务&lt；&lt；类型&gt；_ipp._tcp&lt；/类型&gt；&lt；subtype&gt；_universal._sub._ipp._tcp&lt；/subtype&gt；&lt；port&gt；631&lt；/port&gt；&lt；txt-Record&gt；txtver=1&lt；/txt-Record&gt；&lt；txt-Record&gt；qTotal=1&lt；/txt-Record&gt；&lt；txt-record&gt；rp=printers/Dell_1250c_Color_Printer&lt；/txt-record&gt；&lt；txt-Record&gt；ty=戴尔1250c&lt；/txt-Record&gt；&lt；txt-record&gt；adminurl=http://192.168.178.2:631/printers/Dell_1250c_Color_Printer&lt；/txt-record&gt；&lt；txt-Record&gt；备注=戴尔1250c&lt；/txt-Record&gt；&lt；txt-record&gt；priority=0&lt；/txt-record&gt；&lt；txt-Record&gt；product=(GPL Ghostscript)&lt；/txt-Record&gt；&lt；txt-Record&gt；打印机状态=3&lt；/txt-Record&gt；&lt；txt-record&gt；printer-type=0x801046&lt；/txt-record&gt；&lt；txt-record&gt；Transparent=T&lt；/txt-record&gt；&lt；txt-Record&gt；Binary=T&lt；/txt-Record&gt；&lt；txt-Record&gt；传真=F&lt；/txt-Record&gt；&lt；txt-Record&gt；Color=T&lt；/txt-Record&gt；&lt；txt-Record&gt；双面=T&lt；/txt-Record&gt；&lt；txt-Record&gt；Staple=F&lt；/txt-Record&gt；&lt；txt-Record&gt；Copies=T&lt；/txt-Record&gt；&lt；txt-record&gt；Collate=F&lt；/txt-record&gt；&lt；txt-Record&gt；Punch=F&lt；/txt-Record&gt；&lt；txt-Record&gt；/txt-Record&gt；&lt；txt-Record&gt；Scan=F&lt；/txt-Record&gt；&lt；txt-record&gt；pdl=application/octet-stream，应用程序/pdf，应用程序/PostScript，图像/jpeg，图像/png，图像/urf；/txt-Record&gt；&lt；txt-Record&gt；urf=w8，SRGB24，cp1，rs600&lt；/txt-Record</p><p>根据您的设置，您应该在systemd-Resolution中禁用多播DNS，因为我们将结合使用avahi和nss-mds。</p><p>您的Linux客户系统将使用网络打印机，一旦CUPS和Avahi在那里运行，它将自动检测打印机。使用以下命令查看您的服务器是否正在播发打印机。</p><p>Avahi-BROWSE-ART+wlan0 IPv4 Dell 1250c_ip._tcp local=wlan0 IPv4 Dell 1250c_ip._tcp local hostname=[picoud.local]address=[192.168.178.2]port=[631]txt=[&#34；URF=w8，SRGB24，CP1，Rs600&#34；&#34；PDL=application/octet-stream，application/pdf，application/postscript。&#34；Punch=F&#34；&#34；Colate=F&#34；&#34；副本=T&#34；&#34；装订=F&#34；&#34；双面=T&#34；&#34；颜色=T&#34；&#34；传真=F&#34；&#34；二进制=T&#34；&#34；透明=T&#34；&#34；打印机类型=0x801046&#。&#34；Priority=0&#34；&#34；备注=DELL 1250c&#34；&#34；adminurl=http://192.168.178.2:631/printers/Dell_1250c_Color_Printer&#34；&#34；ty=DELL_1250c_Color_Printer&#34；&#34；rp=printers/Dell_1250c_Color_Printer&#34；&#34；qTotal=1&#34；&#34；txtver=1&#34；]。</p><p>在iOS 13、Windows 10和最新版本的Ubuntu上，无需安装任何驱动程序即可发现和使用打印机。</p><p>*此表单收集您的姓名、电子邮件和内容，以便我们可以跟踪网站上的评论。有关更多信息，请查看我们的隐私政策，在该政策中，您将获得有关我们存储您的数据的位置、方式和原因的更多信息。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.project-insanity.org/2020/05/19/cups-airprint-server-with-legacy-printer-driver-support/">https://blog.project-insanity.org/2020/05/19/cups-airprint-server-with-legacy-printer-driver-support/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/打印/">#打印</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/qemu/">#qemu</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/legacy/">#legacy</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/lt/">#lt</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1004152.html"><img src="http://img.diglog.com/img/2020/5/thumb_8fb6ba72ad8d059c8f97495f22f8a707.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1004152.html">选择2FA验证器应用程序可能很困难。Ars做的，所以你不必</a></div><span class="my_story_list_date">2020-5-29 6:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1004045.html"><img src="http://img.diglog.com/img/2020/5/thumb_b64cbbc11ed152f6750f8f443c417c5a.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1004045.html">我构建了另一个写作应用程序</a></div><span class="my_story_list_date">2020-5-28 15:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003947.html"><img src="http://img.diglog.com/img/2020/5/thumb_de354e3f9edb91de4fe7f4613b66adba.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003947.html">使用regmap使Linux驱动程序更加通用</a></div><span class="my_story_list_date">2020-5-28 0:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003913.html"><img src="http://img.diglog.com/img/2020/5/thumb_5c0ea854ed30c71e51bb1a7263c4126f.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003913.html">StopCovid19的源代码-法国国家反Covid程序</a></div><span class="my_story_list_date">2020-5-27 20:47</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>