<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>标准库的快捷方式</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">标准库的快捷方式</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-08 14:44:07</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/5/169c78bfefc5febabeef423e2603ed59.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>我们最近决定大幅扩展Dark的标准库。虽然我们的标准库为Dark“框架”提供了很多功能，包括HTTP、Worker/Queue和数据存储函数，但我们在“包含电池”语言中所期望的常规函数(如用于数学和操作标准数据类型(如列表、字典、数字和字符串)的函数)上略显不足。</p><p>作为更快发货的捷径，我们决定从榆树标准库开始。ELM的标准库设计得很好，在可用性方面有很大的考虑。Dark和Elm都是为相似的受众设计的：第一次使用函数式语言的前端开发人员。黑暗和榆树的语言有许多共同之处，黑暗受到榆树和其他类似语言(如OCaml)的影响。真的，榆树有一个完美的标准库，可以从中获取灵感！</p><p>这也不是我们第一次使用榆树标准库：Dark是第一年用榆树编写的，我们使用榆树的标准库来影响我们的桌布OCaml标准库。</p><p>考虑到这些相似之处和我们之前的经验，使用榆树的库来扩展Dark的标准库似乎微不足道。然而，Elm和Dark之间的细微语义差异导致了在实践中如何工作的重大微妙之处。</p><p>在许多情况下，我们需要实现与我们正在查看的ELM函数不同的行为或函数签名。所有这些都可以归结为细微的语言差异。</p><p>ELM支持将流水线作为一流的语言功能。例如，在Elm中，您可以编写：</p><p>大多数ELM函数都设计为允许简单的流水线操作：您正在操作的主值排在最后。Paul花了大量时间编写Clojure，它使用了流水线，但没有严格遵守这一原则，这也是使Elm成为一件令人愉快的事情的原因之一。</p><p>虽然Dark也是为流水线设计的，但我们改为通过管道进入第一个位置。因为我们通过管道进入第一个位置，所以显然需要更改参数顺序才能获得相同的效果。</p><p>但它走得更远了一点。ELM的函数名称通常会考虑参数顺序。例如，在以下情况中，ELM使用后缀“by”、“base”和“with”，指的是第一个参数。</p><p>List.map(ReainderBy 4)[-5，-4，-3，-2，-1，0，1，2，3，4]--[-1，0，-3，-2，-1，-1，0，1，2，3，0]logBase 10 100==2 logBase 2 256=8排序带有flippedCompison[1，2，3，4，5]==[5，4，3，2，1]flippedcompison a b=案例比较LT-&G。</p><p>对于Dark的版本，我们最终使用List：：sortByCompator而不是List.sortWith，使用Int：：Remainer作为RemainerBy，以便将命名与不同管道行为所需的参数顺序相匹配。我们忘了添加日志函数，但我们可能已经将其命名为Int：：log。</p><p>ELM在全局名称空间中添加了许多数学函数，包括abs和pi。使用较小的可识别的数学名称可以让您比写出的表达式更快、更有效地理解复杂的表达式，因此这些短名称通常是有意义的。然而，当我们权衡“黑暗”的设计目标时，它开始看起来截然不同。</p><p>黑暗开发者正在同时学习黑暗语言和黑暗编辑器。因此，我们在很大程度上依赖于自动完成来使标准库可被发现。将所有函数放在模块名称空间中便于发现函数，因此将这些函数放入Math名称空间或相关的名称空间(如Int或Float)是有意义的。</p><p>榆树有一个数字类型类，这是黑暗还没有的，这意味着在榆树中，abs可以同时使用整数和浮点数。将这些函数放在模块中允许我们根据类型进行区分：我们有Int：：AbsoluteValue和Float：：AbsoluteValue。</p><p>最后，我们决定不使用短函数名。我们认为Dark通常不用于复杂的数学表达式，因此缩短函数名没有多大价值。数学表达式在前端更为常见，Elm就是为此而设计的。</p><p>我们确实有计划通过提供对编辑器如何显示名称的控制来支持短名称，或者通过在自动完成中为不同的名称赋予别名来增加函数可发现性，但是我们还没有充实这些想法。</p><p>标准库需要管理安全性和易用性之间的微妙界限。榆树必须走这条线，并不是所有的功能都落在这条线的一边。例如，Elm的String.uncons返回笨重的可能(char，string)。同时，当列表具有不同的长度时，List.map2会静默地从较长的列表中删除元素。</p><p>Dark试图在可能的情况下既支持安全性又支持易用性。我们构建了一个名为“Error Rail”的功能，它可以自动展开选项和结果，使它们更易于在编码的早期探索性阶段使用，此时快速而简单地编写代码比处理所有可能情况更重要。稍后，当程序员希望确保他们的代码在每种特殊情况下都能正常工作时，他们可以“将函数从错误轨道上移除”来处理边缘情况。</p><p>这会影响Dark‘s List：：Map2的设计。此函数接受两个列表，并对两个列表中相同位置的参数调用函数。当清单的长度不同时，我们是否应该：</p><p>通过让它正常工作来选择易用性(通过不安全地忽略较长列表中的额外元素，就像Elm所做的那样)？</p><p>或者选择确保程序员知道列表何时不同长度的安全性(代价是将返回值包装在程序员必须处理的选项中，这类似于OCaml Core所做的事情)？</p><p>由于存在错误轨道，实现list：：map2以返回选项使得列表长度相等的常见情况变得容易：</p><p>如果作者知道列表的长度永远不会不同，那么它们就可以到此为止。或者，他们可以将该功能从轨道上移除以处理选项：</p><p>如果他们想要从较长的列表中删除元素的行为，他们可以改用我们新的list：：map2Shortest(当编码器使用map2时，自动完成将显示这两个选项，因此这是可发现的)：</p><p>关于浮点也有类似的问题。Dark中的一个目标是不使用NaN(NaN是浮点值，当您使用不确定的结果(如0.0/0.0)执行浮点数学时会显示该浮点值)。既然Dark已经对结果类型进行了结构化的错误处理，为什么还要通过NAN支持隐式错误呢？</p><p>不过，ELM确实有NAN，所以当我们设计浮点函数时，它们在NAN的情况下都有不同的行为，它们也有不同的签名(返回结果而不是普通浮点)。</p><p>所以我们选择了安全性，并允许Error Rail提供易用性，对吗？可惜不是。不幸的是，我们发现我们还不支持运算符的错误轨道，这使得将结果用于算术变得困难。此外，错误轨道在其当前表现形式中实际上是为了使原型更容易，但是如果不从轨道上提取值，您就不能实际处理错误。这使得将其用于诸如算术之类的事情变得很麻烦。唉，我们不得不暂时搁置这件事。</p><p>我们不相信我们在这一轮的标准库中都做对了。幸运的是，我们将Dark设计为易于更改，并且我们添加的每个函数都是单独版本的。这允许我们稍后创建新版本的函数，使用Dark的开发人员可以单独选择升级。</p><p>在项目过程中，我们添加了61个函数，在某些情况下不建议使用旧的、命名不佳的函数。现在，我们总共在Bool、Float、Int、Math、Dict、List、Option、Result和String模块中有125个“基本”函数(这不包括HTTP、DB和其他Dark框架模块)。</p><p>在这125个函数中，我们最终使用ELM中的不同函数名称的有44个，参数顺序不同的有30个，行为不同的至少有10个。</p><p>榆树有一个很棒的标准库，它是扩展黑暗的一个很好的起点。语言语义和目标的细微之处对标准库有很大影响，因此我们发现我们需要很好地理解Elm和Dark之间的差异。</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/darklang/shortcutting-a-standard-library-b6a6835f493">https://medium.com/darklang/shortcutting-a-standard-library-b6a6835f493</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/标准/">#标准</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/standard/">#standard</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/函数/">#函数</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>