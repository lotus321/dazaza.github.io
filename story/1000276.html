<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>驯化库伯内斯</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random=2020-05-02-21:20"><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg navbar-light bg-light"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1>驯化库伯内斯</h1><div class="row"><div class="col-lg-8 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time">2020-05-02 18:03:48</div><p>这是一个在家庭网络中运行K8的指南，并将其用作家庭服务器-运行您的博客、媒体库、智能家居、宠物项目等。集群实际上很容易设置，但我们开发人员太过依赖，我们忘记了一些基本的网络和其他低级别的东西-我发现这种体验很有教育意义。</p><p>群集将服务于真实的工作负载-我们将处理将其暴露给互联网、家庭网络中的IP分配、合理的安全性、分布式存储和监控。它面向家庭网络，不依赖负载均衡器、SAN、多个公网IP或任何其他花哨的基础设施。我会尽量保持简单(阅读可靠)--没有‘企业’的花言巧语。</p><p>要继续，请确保您熟悉基本的Kubernetes概念，了解什么是主节点、代理、LoadBalancer服务、部署、入口、持久卷等。</p><p>让我们把K8集群看作一个分层的蛋糕，看看每一层。</p><p>顶部是您正在编写和/或运行的应用程序-这是真正提供价值的部分，也是开发人员花费大部分时间的地方。这可能是你的WordPress博客，你写的一些API和你的比特币交易机器人。</p><p>下一级是用于管理和运行应用程序的服务-即您自己的MySQL数据库、ELK堆栈、监控等。它们不必在您的群集中运行-Amazon/Azure/GCP提供PaaS版本及其托管的K8服务。DevOps和管理员在这里花费了大量时间。</p><p>在系统级别，我们已经获得了组成功能群集的组件-您不能跳过这些组件中的任何一个：</p><p>较小的托管K8提供商(如O vhCloud和DigitalOcean)通常在此级别运营。如果要引导您自己的群集，则必须配置它们。系统管理员和IT服务人员可能大部分时间都在这里度过。</p><p>基础架构层不言而喻-即金属、CPU、RAM、磁盘和物理网络。</p><p>你可能会想买一堆Rasberri Pi，但还有更好的替代方案。在我们深入研究它们之前，请考虑以下几点：</p><p>CPU和RAM集中在一个集群中，你可以从几台旧笔记本电脑或其他过时的工具包中获得一个坚固的20 GB内存和6个内核。我不会购买老式的机架式服务器-它们既便宜又强大，但它们听起来就像一个失速的涡轮风扇，而且它们的功耗太高了。</p><p>存储以另一种方式工作-我们将在群集上安装分布式存储系统，他们(通常)保留3份数据拷贝以实现冗余。像PI这样的SBC在这方面非常笨拙，它们的性能比任何有合适SSD的产品都低10倍，可靠性也更低。像Intel-NUC这样的迷你PC通常有两个版本--“较胖”的一个，它有一个额外的SATA驱动器插槽，你可以用来做硬盘。</p><p>您需要一个具有“始终在线”功能的系统，以便计算机在断电后自动启动，至少对于主节点是这样。它在大多数台式机和SBCS的BIOS设置中，但大多数笔记本电脑没有。</p><p>所有的套件都插在一个千兆以太网交换机上。从左到右分别为：</p><p>Beelink Gemini X45配备J4105 8 GB内存、128 GB固态硬盘和320 GB硬盘，这是主节点。</p><p>带有4 GB内存、SD卡、机箱等的PI4大约是GB 100。花同样的钱，你可以买到一台无名的Intel-ATOM迷你PC，这些都带有x86 Arch、真正的BIOS和真正的sata或m.2端口的好处。</p><p>对于GB 200，你可以买到二手迷你台式机，比如ThinkCentre M700 i5-6400T。这是一个重大的性能改进，但设备更大了。</p><p>在GB 300及以上版本，您可以构建全新的、紧凑的HTPC系统，例如基于华硕DeskMini A300和全功能台式机组件。或者，如果空间有限，您也可以选择英特尔-NUC。</p><p>首先，也是最重要的，如果您想要托管任何Web服务，您需要确保不会落后于运营商级NAT。我的提供商默认使用它，但我每月多付5 GB就可以得到一个静态IP。</p><p>接下来，让我们假设您有一个DNS注册商，并为自己获得了域timmy.com。与云中的典型部署不同，我们只有一个IP地址可供使用，因此请设置记录，将来自timmy.com和*.timmy.com(任何子域)的流量定向到您的公共IP地址，以便流量到达您的路由器。</p><p>分配给家庭网络中重要设备的静态IP范围，通常从您的路由器开始，我使用的是192.168.0.1-255。应该为群集中的所有计算机/节点提供静态IP。</p><p>DHCP分配范围，适用于连接到您的网络的各种设备“仅仅是为了使用互联网”，比如您的手机。我将路由器中的DHCP服务器配置为使用192.168.0-255。</p><p>Kubernetes服务将拥有自己的浮动IP地址，而实际的服务可能位于集群中的任何节点上，这取决于负载和Kubernetes调度器的突发情况。我们将在ARP模式t中使用MetalLB</p><div class="sotry_link"><a target="_blank" href="https://blog.quickbird.uk/domesticating-kubernetes-d49c178ebc41">https://blog.quickbird.uk/domesticating-kubernetes-d49c178ebc41</a></div><div class="story_tags"><button type="button" class="btn btn-light my_tag"><a href="/tag/服务/">#服务</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/storage/">#storage</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/运行/">#运行</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/cluster/">#cluster</a></button></div></div></div><div class="col-lg-4 col-0"><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/百度/">#百度</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/搜索/">#搜索</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/科学/">#科学</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/flash/">#flash</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/人像/">#人像</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/动物/">#动物</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/互联网/">#互联网</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/logo/">#logo</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/在线/">#在线</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/twitter/">#twitter</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/浏览器/">#浏览器</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/电影/">#电影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/搜索引擎/">#搜索引擎</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/雷人/">#雷人</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/腾讯/">#腾讯</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/搞笑/">#搞笑</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/日本/">#日本</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/css/">#css</a></button></div></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com <div style="color:#ffffff;font-size:1px;">2020-05-02 21:20:11</div></div></div><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script></body></html>