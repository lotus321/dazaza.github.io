<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何用Nuxt.js构建JAMStack多语言博客</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">如何用Nuxt.js构建JAMStack多语言博客</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-22 15:49:29</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/5/3ab961c60726e4c087cf73b74e878830.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>JAMStack(Javascript，API and Markup Stack)是一个围绕制作Web项目的新方式的术语，在这种方式下，您不必托管自己的后端来构建站点，而是在构建时呈现一组静态页面，并将它们部署到内容交付网络(CDN)。这意味着更好的安全性、更高的可扩展性和更好的网站性能。</p><p>在本教程中，您将学习如何使用Nuxt.js构建一个JAMStack多语言博客，Nuxt.js是一个强大的Vue框架，支持SPA、SSR和静态生成的渲染，与Strapi Headless CMS一起存储数据并公开它们以生成静态博客。要在本地设置STRIPI，您可以遵循本指南，否则您可以使用在我们的服务器https://strapi.lotrek.net/.上运行的只读实例。</p><p>使用Strapi，我构建了一个朴素的结构来支持翻译，其中的Post表包含链接到一个或多个包含翻译的TransPost元素的元素。</p><p>_|POST||TRANS_POST|=||已发布||语言||Created_At|&lt；--(1)-(N)--&gt；&gt；|标题|内容|slug|=。</p><p>你可以使用GraphQL游乐场来玩它，并探索后端。请记住，本教程的重点是Nuxt.js，您可以使用任何想要生成最终静态站点的后端。</p><p>记住选择axios选项(您稍后会用到它)并添加一个UI框架，比如Buefy。</p><p>并在services文件夹下创建index.js文件来包装所有查询。此客户端应实现3种方法：</p><p>getAllPosts：获取特定语言的所有帖子，显示其他语言的slug、标题、内容和其他帖子的slug，以获取备用URL。</p><p>getSinglePost：获取具有特定插件和语言的单个帖子，以其他语言显示所有属性和帖子。</p><p>从Apollo-Fetch导入{createApolloFetch}导出默认类BlogClient{structor(){this。apolloFetch=createApolloFetch({uri：`${process.。环境。NUXT_ENV_BACKEND_URL}/raphql`})}getAllPostsHead(Lang){const allPostsQuery=`query AllPosts($lang：string！){transPosts(where：{lang：$lang}){slug title}}`返回此参数。apolloFetch({query：allPostsQuery，Variables：{lang}})}getAllPosts(Lang){const allPostsQuery=`query AllPosts($lang：string！){transPosts(where：{lang：$lang}){slug title content post{Publisher transPosts(where：{lang_ne：$lang}){slug lang}`返回此参数。apolloFetch({query：allPostsQuery，Variables：{lang}})}getSinglePost(slug，lang){const simplePostQuery=`查询发布($slug：string！，$lang：string！){transPosts(where：{slug：$slug，lang：$lang}){slug标题内容POST{发布的transPosts(其中：{lang_ne：$lang}){slug。apolloFetch({query：simplePostQuery，变量：{slug，lang}})}}。</p><p>要使BlogClient在您有权访问上下文时可用(例如，在asyncData函数中)，请创建plugins/ctx-inject.js文件。</p><p>从&#39；~/services&#39；导入BlogClient导出默认值({app}，Inject)=&gt；{app.。$blogClient=new BlogClient()}。</p><p>这个博客的结构将非常简单，在主页(/)中会有一个帖子列表和一个阅读文章的链接(/blog/&lt；postslug&gt；)。现在您可以从上下文访问BlogClient实例了，现在开始重写主页组件(Pages/index.vue)，以使用名为asyncData的特殊方法获取博客帖子，并为每个帖子呈现标题和链接。asyncData接收上下文作为第一个参数，并且可以通过context.app.$blogClient访问您的BlogClient实例。</p><p>&lt；template&gt；&lt；Section class=&#34；&gt；&lt；div class=&#34；is-mobile&#34；&gt；&lt；div v-for=&#34；帖子&#34；：key=&#34；post.slug&#34；&gt；&lt；h2&gt；{{post.title}}&lt；/H2&gt；&。博客-slug&#39；，params：{slug：post.slug}}&#34；&gt；阅读更多.。&lt；/nuxt-link&gt；&lt；/div&gt；&lt；/div&gt；&lt；/Section&gt；&lt；/template&gt；&lt；脚本&gt；导出默认值{name：&#39；主页&#39；，异步异步数据({app}){const postsData=等待APP。$blogClient。getAllPostsHead(&#39；EN&#39；)返回{Posts：postsData。数据。transPosts}}，data(){return{post：[]}&lt；/script&gt；</p><p>添加/blog/&lt；postslug&gt；route，创建组件blogpost(page/blog/_slug.vue)。安装Vue Markdown组件以正确呈现文章(纱线添加Vue-markdown)。</p><p>&lt；模板&gt；&lt；Section class=&#34；&gt；&lt；div class=&#34；is-mobile&34；&gt；&lt；h2&gt；{{post.title}}&lt；/h2&gt；&lt；vue-markdown&gt；{{post.content}}&lt；/vue-markdown&gt；&lt；/div&。脚本&&gt;导出默认值{name：&#39；blogpost&#39；，组件：{&#39；vue-markdown&#39；：VueMarkdown}，异步异步数据({app，route}){const postsData=等待APP。$blogClient。getSinglePost(路由。参数。slug，&#39；en&#39；)返回{POST：postsData。数据。transPosts[0]}}，data(){return{post：null}&lt；/script&gt；</p><p>常量区域设置=[{code：&#39；en&#39；，iso：&#39；en-US&39；}，{code：&#39；es&#39；，iso：&#39；es-es&#39；}，{code：&#39；it&#39；it-IT&#39；}]const default_locale=&#39；en&#39；导出默认值{//.。I18N：{locales：locales，defaultLocale：default_locale，encodePath：false，vueI18n：{fall backLocale：default_locale，Messages：{en：{readmore：&#39；read more&#39；}，es：{readmore：&#39；Lee mass&#39；}，it：{readmore：&#39；leggi di pi？？&#39；}//.}。</p><p>现在您可以修改主页组件了：在nuxt-link中，您应该使用localePath，并使用$t呈现翻译后的标签readmore。</p><p>在asyncData中，您可以使用上下文的store.$i18n属性获取帖子列表，以获取当前语言。</p><p>//.。异步异步数据({app，store}){const postsData=等待应用。$blogClient。getAllPostsHead(存储。1.18亿美元。区域设置)返回{POSTS：postsData。数据。TransPosts}}，//.。</p><p>//.。异步异步数据({app，route，store}){const postsData=等待APP。$blogClient。getSinglePost(路由。参数。鼻涕虫，商店。1.18亿美元。区域设置)返回{POST：postsData。数据。TransPosts[0]}}，//.。</p><p>&lt；template&gt；&lt；b-navbar-dropdown：label=&#34；$i18n.locale&#34；&gt；&lt；nuxt-link v-for=&#34；locale&#34；：key=&#34；locale.code&#34；class=&#34；navbar-item&#34；：to=&#34；switchLocalePath(locale.code)。/b-navbar-dropdown&gt；&lt；/template&gt；&lt；script&gt；export default{Computed：{availableLocales(){return this。1.18亿美元。地点。筛选器(区域设置=&gt；区域设置。代码！==这个。1.18亿美元。区域设置)}&lt；/script&gt；</p><p>并将其包含在布局/default.vue中，以使其在导航栏中可用。此组件调用switchLocalePath以获取指向另一种语言的当前页面的链接。要使语言切换器使用动态路由，您需要使用store.dispatch设置blogpost组件中的slug参数。</p><p>//.。异步异步数据({app，route，store}){const postsData=等待APP。$blogClient。getSinglePost(路由。参数。鼻涕虫，商店。1.18亿美元。地点)等待商店。派单(&#39；i18n/setRouteParams&#39；，对象。FromEntries(postsData.。数据。TransPosts[0]。发帖。转弯。map(el=&gt；[el.。朗，{鼻涕虫：EL。slug}])返回{POST：postsData。数据。TransPosts[0]}}，//.</p><p>记住使用.env或直接(导出NUXT_ENV_BACKEND_URL=https://strapi.lotrek.net)并启动开发服务器)设置博客客户端使用的NUXT_ENV_BACKEND_URL环境变量。</p><p>ℹ生成页面✔生成/它/✔生成/ES/✔生成/✨在43.49秒内完成。</p><p>正如您所看到的，不会生成动态路由，因为Nuxt.js不知道如何生成它们。要添加动态路由支持，您必须在nuxt.config.js中的Generate settings下实现routes函数，并返回一个包含您想要生成的路由和包含POST的有效负载的对象列表。</p><p>从&#39；导入BlogClient。/services&#39；//.。导出默认值{//.。生成：{routes：async()=&gt；{const client=new BlogClient()let routes=[]let postsData=[]for(区域设置的常量区域设置){postsData=等待客户端。getAllPosts(区域设置。代码)ROUES=ROUTS。Concat(postsData.。数据。转弯。map((Post)=&gt；{return{route：`${locale.。code=DEFAULT_LOCALE？&#39；&#39；：&#39；/&#39；+区域设置。code}/blog/${post.。slug}`，有效负载：POST}}))}返回路由}}//.}。</p><p>由于有效负载在上下文中可用，您可以重构blogpost组件中的asyncData函数，以从context.payload获得特定的帖子。</p><p>const getSinglePostFromContext=async({app，route，store，payload})=&gt；{if(Payload){return payload}const postsData=等待APP。$blogClient。getSinglePost(路由。参数。鼻涕虫，商店。1.18亿美元。区域设置)返回postsData。数据。transPosts[0]}导出默认值{name：&#39；blogpost&#39；，async asyncData(Context){const singlePost=await getSinglePostFromContext(Context)等待上下文。商店。派单(&#39；i18n/setRouteParams&#39；，对象。FromEntries(singlePost.。发帖。转弯。map(el=&gt；[el.。朗，{鼻涕虫：EL。slug}])return{post：singlePost}}，//.}。</p><p>ℹGenerating Pages✔Generated/it/✔Generated/ES/✔Generated/✔Generated/Blog/Hello-World✔Generated/it/Blog/Cao-mondo✨在33.82秒内完成。</p><p>静态生成后您可以注意到的一个问题是，在客户端导航期间仍然会进行asyncData调用，这意味着外部API服务器应该在您的静态网站联机时运行(如果Strapi服务器关闭，您将无法获取&#34；消息)。这是一个已知的问题，Nuxt.js团队正在努力在下一个版本中支持nuxt生成的完全静态生成，目前您可以使用nuxt-payload-提取器插件。随一起安装</p><p>const getSinglePostFromContext=async({$axios，$payloadURL，app，route，store，payload})=&gt；{if(Payload){return payload}let postsData=null if(Process.。静态&amp；&amp；进程。客户端&amp；&amp；$payloadURL){postsData=等待$axios。$get($payloadURL(Route))返回postsData。post}postsData=等待应用程序。$blogClient。getSinglePost(路由。参数。鼻涕虫，商店。1.18亿美元。区域设置)返回postsData。数据。传输发布[0]}。</p><p>异步异步数据({$axios，$payloadURL，app，route，store}){if(进程。静态&amp；&amp；进程。客户端&amp；&amp；$payloadURL){返回等待$axios。$get($payloadURL(Route))}const postsData=等待APP。$blogClient。getAllPostsHead(存储。1.18亿美元。区域设置)返回{POSTS：postsData。数据。传输发布}}。</p><p>有时，您可能需要为动态路由配置一个自定义路径，例如，您可能希望为英语保留/blog/：slug path，为西班牙语保留/artículos/：slug route，为意大利语保留/titioli/：slug route。遵循nuxt-i18n文档，您必须在nuxt.config.js的i18n部分中指定这些路由。</p><p>I18N{//.。parsePages：false，Pages：{&#39；blog/_slug&#39；：{it：&#39；/jotioli/：slug&#39；，es：&#39；/artículos/：slug&#39；，en：&#39；/blog/：slug&#39；}}，//.}。</p><p>要使这些设置在I18N配置和生成函数中都可重用，请在单独的文件i18n.config.js中移动自定义路由。</p><p>导出默认{Pages：{&#39；blog/_slug&#39；：{it：&#39；/jotioli/：slug&#39；，es：&#39；/artículos/：slug&#39；，en：&#39；/blog/：slug&#39；}。</p><p>从&#39；导入i18nConfig。/i18n.config&#39；//.。导出默认值{//.。I18n：{locales：locales，defaultLocale：default_locale，parsePages：false，Pages：I18nConfig。页面，编码路径：FALSE，vueI18n：{fall backLocale：DEFAULT_LOCALE，//.}}，//.。</p><p>路由：async()=&gt；{const client=new BlogClient()let routes=[]let postsData=[]for(区域设置的常量区域设置){postsData=等待客户端。getAllPosts(区域设置。代码)ROUES=ROUTS。Concat(postsData.。数据。转弯。map((Post)=&gt；{return{route：`${locale.。code=DEFAULT_LOCALE？&#39；&#39；：&#39；/&#39；+区域设置。代码}${i18nConfig。Pages[&#39；blog/_slug&39；][区域设置。代码]。更换(&#39；：slug&#39；，POST。slug)}`，有效负载：POST}})}}返回路线}</p><p>ℹGenerating Pages✔Generated/Blog/Hello-World✔Generated/it/Artioli/Cao-mondo✔Generated/ES/ARTículos/Hola-Mundo✔Generated/ES/✔Generated/it/✔Generated/✨在33.82秒内完成。</p><p>在此存储库中，您可以看到本教程的完整代码，结果部署在Netlify CDN上，网址为https://eager-shockley-a415b7.netlify.app/.。Netlify是我最喜欢的服务之一，它为静态网站提供云托管，提供持续部署、免费SSL、无服务器功能等……。最后的代码向网站添加了一些缺失的功能，例如，它添加了作者支持，为了简单起见使用了这里省略的一些外部组件，并启用了项目的SEO选项来向页面添加元数据(参见nuxt-18n文档中的SEO部分)。</p><p>最终代码中包含的另一个有用的东西是由Nuxt.js站点地图模块提供的站点地图。Sitemap很容易设置，因为它在默认情况下采用Generate.routes值，因此会自动包含动态路由。配置非常简单，只需在nuxt.config.js文件的模块数组部分的末尾添加@nuxtjs/sitemap。</p><p>导出默认值{//.。站点地图：{hostname：base_url，gzip：true，i18n：default_locale}//.}</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://dev.to/astagi/how-to-build-a-jamstack-multi-language-blog-with-nuxt-js-3gah">https://dev.to/astagi/how-to-build-a-jamstack-multi-language-blog-with-nuxt-js-3gah</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/构建/">#构建</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/jamstack/">#jamstack</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/slug/">#slug</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1002461.html"><img src="http://img.diglog.com/img/2020/5/thumb_778c846a152e2049675e63a0807af38e.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002461.html">如果我能把一件事带回互联网，那就是博客</a></div><span class="my_story_list_date">2020-5-17 6:56</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002422.html"><img src="http://img.diglog.com/img/2020/5/thumb_778c846a152e2049675e63a0807af38e.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002422.html">如果我能把一件事带回互联网，那就是博客</a></div><span class="my_story_list_date">2020-5-17 2:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1001950.html"><img src="http://img.diglog.com/img/2020/5/thumb_d9e68ebfe7718bafe7868ceda171d9f7.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001950.html">用普罗米修斯·维克多·亚当的博客监控Python烧瓶微服务</a></div><span class="my_story_list_date">2020-5-13 17:16</span></div><div class="col-sm"><div><a target="_blank" href="/story/1001184.html"><img src="http://img.diglog.com/img/2020/5/thumb_af1c1242df1b8569a0e08209de052b96.gif" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001184.html">设计和开发我们自己的(不那么无聊的)公司博客</a></div><span class="my_story_list_date">2020-5-8 6:41</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>