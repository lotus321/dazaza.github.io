<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>面向价值的编程</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">面向价值的编程</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-03 04:19:48</div><div class="page_narrow text-break page_content"><p>在WWDC 2015上，Dave Abrahams在一个非常有影响力的主题为“SWIFT中面向协议的编程”的会议上解释了如何使用SWIFT的协议来克服类的一些缺点。他建议这样一条规则：“不要从上课开始。从协议开始。“。</p><p>为了说明这一点，Dave描述了一种面向协议的原始绘图应用程序方法。该示例从几个基本体形状开始工作：</p><p>协议可绘制{}结构多边形：可绘制{var角点：[CGPoint]=[]}结构圆：可绘制{var center：CGPoint变量半径：CGFloat}结构图：可绘制{var元素：[可绘制]=[]}。</p><p>在传递对象时，对象的引用语义增加了复杂性。在一个位置更改对象的属性可能会影响有权访问该对象的其他代码。并发性需要锁定，这增加了大量的复杂性。</p><p>通过继承重用代码是很脆弱的。继承还将接口耦合到实现，这使得重用更加困难。这是它自己的主题，但即使是OO程序员也会告诉您“组合胜过继承”。</p><p>对于子类，很难精确识别类型。例如，使用NSObject.isEquity()时，必须注意仅与兼容类型进行比较。协议使用泛型精确标识类型。</p><p>为了处理实际绘制，添加了一个渲染器协议，该协议描述了基本绘制操作：</p><p>协议渲染器{函数移动(至p：cgPoint)函数线(至p：cgPoint)函数弧(中心：cgPoint，半径：cgFloat，起始角度：cgFloat，结束角度：cgFloat)}。</p><p>协议可绘制{函数绘制(_renender：renender)}扩展多边形：可绘制{函数绘制(_渲染器：渲染器){渲染器。移动(到：角落)。最后！)。对于角中的p{渲染器。Line(to：p)}扩展圆：可绘制{函数绘制(渲染器：渲染器){渲染器。圆弧(在：中心，半径：半径，开始角度：0.0，结束角度：两个圆点)}}扩展图：可绘制{函数绘制(渲染器：渲染器){对于元素{f.。绘制(渲染器)}。</p><p>这使得定义不同的渲染器成为可能，这些渲染器可以轻松地处理给定的类型。一个主要卖点是定义测试渲染器的能力，它允许您通过比较字符串来验证绘图：</p><p>struct测试渲染器：渲染器{func move(to p：cgpoint){print(&#34；moveto(\(p.。x)、\(p.。y))&#34；)}函数行(到p：CGPoint){打印(&#34；lineto(\(p.。x)、\(p.。y))&#34；)}函数圆弧(中心：CGPoint，半径：CGFloat，起始角度：CGFloat，结束角度：CGFloat){Print(&#34；Arcat(\(Center)，半径：\(半径)，&#34；+&#34；开始角度：\(开始角度)，结束角度：\(结束角度))&#34；)}}。</p><p>扩展CGContext：渲染器{//CGContext已有`Move(To：CGPoint)`函数行(To p：CGPoint){addLine(To：p)}函数弧(中心：CGPoint，半径：CGFloat，起始角度：CGFloat，结束角度：CGFloat){addArc(中心：中心，半径：半径，起始角度：起始角度，结束角度：结束角度，顺时针：真)}}。</p><p>扩展渲染器{函数圆(在中心：CGPoint，半径：CGFloat){arc(在：中心，半径：半径，起始角度：0，结束角度：两个圆点)}}。</p><p>我认为这种方法相当有说服力。它的可测性要强得多。它还允许我们通过提供单独的渲染器来以不同方式解释数据。而且，值类型巧妙地避开了面向对象版本可能会遇到的许多问题。</p><p>尽管有这些改进，但在面向协议的版本中，逻辑和副作用仍然紧密耦合。Polygon.raw做两件事：它将多边形转换为多条线，然后呈现这些线。因此，当需要测试逻辑时，我们需要使用TestRenender-尽管WWDC Talk暗示了这一点，但它是一种模拟。</p><p>扩展多边形：可绘制{函数绘制(_渲染器：渲染器){渲染器。移动(到：角落)。最后！)。对于角中的p{渲染器。线路(至：P)}。</p><p>在这里，我们可以通过将逻辑和效果分成不同的步骤来将它们分开。让我们声明表示底层操作的值类型，而不是使用MOVE、LINE和ARC的渲染器协议。</p><p>枚举路径：Hasable{struct Arc：Hasable{var center：CGPoint var Radius：CGFloat var startangle：CGFloat var endangle：CGFloat}结构线：Hasable{var start：CGPoint var end：CGPoint}//替换`Arc(at：CGPoint，Radius：CGFloat，startangle：CGFloat，endangle：CGFloat)`案例圆弧(Arc)//替换`。</p><p>现在，Drawables可以返回一组用于绘制它们的路径，而不是调用这些方法：</p><p>协议可绘制{</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://matt.diephouse.com/2018/08/value-oriented-programming/">https://matt.diephouse.com/2018/08/value-oriented-programming/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/编程/">#编程</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/价值/">#价值</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/oriented/">#oriented</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/绘制/">#绘制</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/renderer/">#renderer</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>