<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>15年后：qmail中的远程代码执行(CVE-2005-1513)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">15年后：qmail中的远程代码执行(CVE-2005-1513)</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-05-20 03:55:57</div><div class="page_narrow text-break page_content"><p>日期：Qualys Security Consulting&lt；qsa@.lys.com&gt；收件人：osss-security@.ts.openwall.com主题：qmail中的远程代码执行(cve-2005-1513年)Qualys安全顾问15年后：qmail中的远程代码执行(CVE-2005-1513)==Contents==SummaryAnalysisExploitationqmail-verify-cve-2020-3811-CVE-2020-3812MitigationsAcknowledgmentsPatches==Summary==TLDR：2005年，在qmail中发现了三个漏洞，但一直被修复，因为它们被认为。我们最近重新发现了这些漏洞，并能够在默认installation.--In中远程攻击其中一个漏洞。2005年5月，Georgi Guninski发布了64位Qmail Fun&34；，qmail中的三个漏洞：http://www.guninski.com/where_do_you_want_billg_to_go_today_4.htmlSurprisingly，我们在最近的一次qmail审核中重新发现了这些漏洞；它们从未被修复，因为正如qmail&#39；作者Daniel J.Bernstein(在https://cr.yp.to/qmail/guarantee.html)：&#34；中)所说的那样，这一主张被拒绝。没有人会给每个qmail-smtpd进程分配GB的内存，所以qmail&#39；认为分配的数组长度适合32位的假设是没有问题的。事实上，每个qmail-smtpd进程的内存消耗在默认情况下都是严格限制的(根据qmail-smtpd的启动脚本)；例如，在Debian 10(最新的稳定版本)上，它被限制在大约7MB。不幸的是，我们发现这些漏洞也。作为概念证明，我们开发了一个可靠的、本地的、远程攻击Debian的qmail包的默认配置。此概念验证需要4 GB的磁盘空间和8 GB的内存，并允许攻击者以任何用户的身份执行任意外壳命令，除了root用户(以及一些不拥有其主目录的系统用户)。我们将在不久的将来发布我们的概念验证漏洞。关于我们的新发现，丹尼尔·J·伯恩斯坦发表了以下声明：https://cr.yp.to/qmail/guarantee.html多年来一直提到Qmail的假设，即分配的数组长度适合32位。我在softlimit-m12345678下运行每个qmail服务，并且我建议在其他安装下也这样做。最后，我们还在qmail-verify(例如，debian的qmail包中包含的第三方qmail补丁)中发现了两个小漏洞：cve-2020-3811(绕过邮件地址验证)和cve-2020-3812(本地信息disclosure).==Analysis==We决定利用Georgi Guninski的漏洞)。事实上，在stralloc_readyplus；中有四个潜在的整数溢出；GEN_ALLOC_readyplus()宏(它生成stralloc_readyplus()函数)中有四个潜在的整数溢出，分别位于第21行(n+=x-&&gt;len)、第23行(x-&gt；a=base+n+.)和第24行(x-&gt；a*sizeof(type))：--17#定义GEN_ALLOC_READYPLUS(ta，TYPE，FIELD，LEN，a，i，n，x，base，ta_rplus)\18 int ta_rplus(x，n)寄存器ta*x；寄存器UNSIGNED INT n；\19{REGISTER UNSIGNED INT I；\20 IF(x-&gt;字段){\21 i=x-&gt;；a；n+=x-&gt;；len；\22 IF(n&&gt;i){\23 x-&gt;；a=base+n+(n&&gt;3)；\24 IF(alloc_re(&amp；x-&gt;字段，i*sizeof(Type)，x。\25 x-&gt；a=i；return 0；}\26 return 1；}\27 x-&gt；len=0；\28 return！！(x-&gt；field=(type*)alloc((x-&gt；a=n)*sizeof(Type)；}--and，理论上，alloc()函数本身(由alloc_re()函数调用)中有一个整数溢出，行18：--14/*@.l@.*@out@.har*alloc(N)15 unsign int n；16{17 char*x；18 n=对齐+n-(n&amp；(对齐-1))；/*XXX：可能溢出*/.。20 x=malloc(N)；.。22返回x；23}--In实践中，第21行(在GEN_ALLOC_READYPLUS()中)和第18行(在alloc()中)的整数溢出很难触发；而第24行(在GEN_ALLOC_READYPLUS()中)的整数溢出是无关紧要的</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.openwall.com/lists/oss-security/2020/05/19/8">https://www.openwall.com/lists/oss-security/2020/05/19/8</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/代码执行/">#代码执行</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/remote/">#remote</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/qmail/">#qmail</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1002753.html"><img src="http://img.diglog.com/img/2020/5/thumb_82efedeb18d9559cd423c1fc7be358d4.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002753.html">兰特：枯燥的原则是不好的建议</a></div><span class="my_story_list_date">2020-5-19 15:27</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002674.html"><img src="http://img.diglog.com/img/2020/5/thumb_86dc2c4e9da5ef8bc6e76666b338bdba.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002674.html">梅赛德斯-奔驰车载逻辑单元(OLU)源代码在线泄露</a></div><span class="my_story_list_date">2020-5-19 2:24</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002400.html"><img src="http://img.diglog.com/img/2020/5/thumb_66364db663122bafe8ce53d74fdb93d3.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002400.html">帝国科维模型可能是有史以来最大的软件错误</a></div><span class="my_story_list_date">2020-5-16 23:21</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002160.html"><img src="http://img.diglog.com/img/2020/5/thumb_f89b0acae7c97c28282528da90c8d70c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002160.html">这款人工智能驱动的自动完成器帮助开发人员编写的代码减少25%</a></div><span class="my_story_list_date">2020-5-15 6:8</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>