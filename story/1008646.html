<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>XI-编辑回顾</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">XI-编辑回顾</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-28 03:53:41</div><div class="page_narrow text-break page_content"><p>四年多前，我开始了Xi-Editor项目。现在我已经把它放在了次要位置(尽管开源社区仍有一些活动)。最初的目标是提供非常高质量的编辑体验。为此，该项目花费了相当多的“新颖点”：以Rust为核心的实现语言。一种用于文本存储的绳状数据结构。多进程体系结构，具有前端和插件，每个插件都有自己的进程。完全采用异步设计。CRDT作为并发修改的机制。我仍然相信有可能在原始设计的基础上建立一个高质量的编辑器。不过，我亦相信这会是一个相当复杂的系统，所需的工作远较所需为多。我已经写了这个回顾的CRDT部分，作为对Github问题的评论。这在黑客新闻上引发了很好的讨论。在这篇文章中，我将再次涉及CRDT，但将重点放在系统设计的其他方面。起源习最初的动机来自于研究Android文本栈，特别是面临两个问题。其一，当文本缓冲区变大时，文本编辑将变得非常慢。第二，EditText小部件和键盘(输入法编辑器)之间的接口中存在许多并发错误。第一个问题的罪魁祸首是span Watcher界面，再加上现代键盘喜欢为每个单词设置拼写更正范围。当您插入一个角色时，所有连续的跨度都会将它们的位置增加一个，然后您必须将每个跨度的onspan Changed发送给所有的观察者。再加上Spans数据结构有一个朴素的O(N)实现，而且整个过程是二次的，甚至更糟。并发错误归结为跨两个不同的进程同步编辑，因为键盘是一个不同的进程，而不是承载EditText小部件的应用程序。因此，当您发送更新(例如，移动光标)而另一侧的文本同时更改时，它是指旧位置还是新位置是不明确的。这是以一种“几乎正确”的方式处理的，有内务更新的超时，以最大限度地减少比赛的机会。这方面的一个很好的表现是，在包含复杂表情的文本中慢慢滑动光标可能会导致表情符号的闪烁。这些问题有一个统一的主线：在这两种情况下，文本都有很小的差异，但数据结构和协议以不太理想的方式处理这些差异，从而导致性能和正确性错误。在很大程度上，习一开始是对处理文本编辑操作的“正确方式”的探索。在并发错误的情况下，我希望找到一种通用的、强大的技术来促进分布式ISH系统中的并发文本编辑。虽然大多数操作转换文献都侧重于多个用户协作编辑文档，但我希望其他文本操作(如在文本输入字段上强制执行信用卡格式的应用程序)也适用于一般框架。那也是我开始沉迷于Rust的时候，所以开始制作一个新的绿地文本编辑引擎的原型是很自然的。如果没有向后兼容性限制(Android中的一个大问题)，您将如何“解析文本”？刚开始的时候，我知道Operational Convert是一种协作编辑解决方案，但以复杂和挑剔著称。我不知道OT和CRDT的兔子洞会有多深。这个故事的大部分都是在之前链接的CRDT讨论中讲述的。模块化软件的诱惑有着极其悠久的历史，人们试图将软件构建为通过某种模块间通信结构连接的可组合模块。历史上的例子包括DCE/RPC、Corba、Bonobo，以及最近的沙尘暴和Fuchsia Modular。有一些部分的成功，包括Android上的Binder，但这在很大程度上仍然是一个未实现的愿景。(关于Binder，它是从一个更理想化的愿景演变而来的，我强烈推荐阅读2006年关于OpenBinder的采访)。当我开始习的时候，有迹象表明我们已经到了那里。微服务在Internet世界变得流行起来，当然，所有Web应用程序都有客户端/服务器边界。在Google内部，GRPC运行得相当好，Chrome内部的进程分离也是如此。在Unix领域，终端本身呈现GUI(如果是原始的，但获得了颜色和鼠标等功能)的历史由来已久。还有Blit的传统，当然，还有新闻和X11。我认为最有力的正面模型之一是数据库/业务逻辑拆分，它可以说是流程分离最成功的示例。在此模型中，数据库是res</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://raphlinus.github.io/xi/2020/06/27/xi-retrospective.html">https://raphlinus.github.io/xi/2020/06/27/xi-retrospective.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/编辑/">#编辑</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/editor/">#editor</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/文本/">#文本</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1008521.html"><img src="http://img.diglog.com/img/2020/6/thumb_5ef281e68a04fe0d377de8bb210034d0.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1008521.html">人类胚胎CRISPR基因编辑造成染色体损伤</a></div><span class="my_story_list_date">2020-6-27 15:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007947.html"><img src="http://img.diglog.com/img/2020/6/thumb_c43bd7e48df3fb5b928111dbaa1c235c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007947.html">团队编辑你的图片：北极光(Aurora Borealis)</a></div><span class="my_story_list_date">2020-6-24 16:30</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005824.html"><img src="http://img.diglog.com/img/2020/6/thumb_6477ed7f66318b6c727a54468936da91.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005824.html">看来盗窃案在增加。</a></div><span class="my_story_list_date">2020-6-9 16:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003529.html"><img src="http://img.diglog.com/img/2020/5/thumb_5e8eacf2aa880a7b09d24dc9bec495c3.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003529.html">维基百科计划制定新规则打击“有毒行为”</a></div><span class="my_story_list_date">2020-5-24 23:46</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>