<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>以正确的方式为本地移动构建OpenID连接流</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">以正确的方式为本地移动构建OpenID连接流</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-10 05:18:09</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/6/dc76512d39e590f714b9a4f2b2d293e1.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><div class="page_narrow text-break page_content"><p>寻找有关如何为本地移动应用程序实现OpenID Connect的准确指导方针是一段艰难的旅程。大多数可用的资源没有遵循最佳实践，而其他资源则留下了一些重要的问题没有得到回答。</p><p>这里的目标不是重新发明轮子，而是呈现一个简单而完整的移动OpenID Connect流的健壮实现。它基于验证码流程，遵循最新的官方指南RCF 8252和IETF OAuth 2.0安全最佳实践，完全兼容OpenID Connect Foundation Android SDK和OpenID Connect Foundation iOS SDK。</p><p>考虑到隐式授予流的漏洞，从现在开始应该使用授权码授予流。</p><p>考虑到移动设备上的身份验证流，使用本机实现是相当直观的。但是，将身份验证部分保留在浏览器中可帮助您实现重要目标：</p><p>安全性：通过浏览器并使用授权服务器的Web身份验证表单，您可以立即受益于它们可能已经实现的安全机制(例如：沙箱、证书验证、…)。。</p><p>用户信任：您可能认为本机实现总是更高效。但是，从用户的角度来看，必须在您的应用程序中直接提供他的第三方凭据似乎是一个潜在的安全问题。他怎么知道你不会一路上偷他的证件呢？</p><p>可维护性：当身份验证通过浏览器时，身份验证流被委托给授权服务器。那么，如果授权服务器想要实施新的机制(即：双因素身份验证、用户同意、…)，该怎么办呢？？你这边什么都没有。它对您的应用程序将是完全透明的。</p><p>任何与移动应用程序捆绑在一起的秘密都不应该被认为是秘密。AppAuth和RCF 8252-SECTION-5.3.3强调了这一点，并声明要确保CLIENT_SECRET应该保存在服务器端。太好了，让我们把它保存在服务器端，但是把这个秘密存储在一个代理中！但是一旦这样做了，您就会意识到，如果您的客户端应用程序和服务器之间没有强身份验证，您的client_secret将是保密的，但是任何人都可以通过您的代理来模拟您的应用程序。因此，任何捕获OAuth身份验证代码的攻击者都可以通过您的代理模拟您的应用程序，并从中获取用户Access_Token。</p><p>此身份验证过程应使用已注册的浏览器或“应用内浏览器选项卡”来处理，而不是使用“Web视图”(参见RFC 8252)。</p><p>您应该使用Android应用程序链接和iOS通用链接，因此只有您的应用程序才能通过redirect_uri获取授权回调。</p><p>您可能想要限制允许哪个浏览器执行此过程，AppAuth提供了一种机制来控制使用哪个浏览器进行授权。</p><p>如果您的身份验证服务器不支持PKCE，则不支持CODE_CHANGLISH和CODE_CHANGLE_METHOD参数。在这种情况下，至少使用STATE参数来防止csrf攻击(请参阅https://tools.ietf.org/html/draft-ietf-oauth-security-topics-15#section-4.7.1).。</p><p>我们现在将检查一下我们的应用程序服务器。为此，我们在服务器上定义了POST/open_id_connect端点。此端点将与Access_Token和来自授权服务器的声明交换给定的代码(和code_verizer)。</p><p>对授权服务器在用户身份验证成功时返回给redirect_uri的代码进行编码。</p><p>CODE_VERIFIER PKCE CODE_VERIFIER，与身份验证过程中发送到授权服务器的CODE_CHANGLISH匹配。</p><p>在我们的实现中，我们还添加了一个Account属性，该属性将提供有关平台上现有用户帐户(如果有)的信息。</p><p>现在您就知道了来自授权服务器的最终用户身份(access_Token和Claims)，以及该用户是否已经在您的服务器(帐户)上注册。因此，您可以决定最终用户是否需要注册或登录，并使用收集的信息来支持这些流程。</p><p>如果您遵循正确的指导方针，在移动设备上构建简单&amp；Secure OpenID Connect身份验证流程非常简单；-)很高兴回答您的任何建议！</p></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/klaxit-techblog/openid-connect-for-mobile-apps-fcce3ec3472">https://medium.com/klaxit-techblog/openid-connect-for-mobile-apps-fcce3ec3472</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/构建/">#构建</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/openid/">#openid</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/身份验证/">#身份验证</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1005832.html"><img src="http://img.diglog.com/img/2020/6/thumb_e7e49567d75cd8d266643cdfb3f9839c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005832.html">在几分钟内构建您自己的PaaS</a></div><span class="my_story_list_date">2020-6-9 18:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005622.html"><img src="http://img.diglog.com/img/2020/6/thumb_404569fc6269a0333dc97c4e93e65b21.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005622.html">不带Micosoft品牌/遥测/许可的VS代码</a></div><span class="my_story_list_date">2020-6-8 4:51</span></div><div class="col-sm"><div><a target="_blank" href="/story/1004002.html"><img src="http://img.diglog.com/img/2020/5/thumb_6df6ff571c944ed2d5c0f8ccf96980b7.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1004002.html">介绍积雪2.0</a></div><span class="my_story_list_date">2020-5-28 7:18</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003925.html"><img src="http://img.diglog.com/img/2020/5/thumb_25b59b223c17e5129137ec9a406b7e74.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003925.html">我们是如何构建撤消的</a></div><span class="my_story_list_date">2020-5-27 22:40</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/app/">#app</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/冠状病毒/">#冠状病毒</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>