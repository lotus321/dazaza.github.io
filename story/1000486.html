<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Docker Sarm集群完成指南</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1>Docker Sarm集群完成指南</h1><div class="row"><div class="col-lg-8 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time">2020-05-03 21:33:07</div><div class="story_img_container"><img src="http://img.diglog.com/img/2020/5/24d51da21a85571ce94d2a83dcb34447.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></div><p>为了实现高可用性并简化容器的管理，我们可以创建群集。它由安装了坞站引擎的耦合节点组成。</p><p>每个节点都安装了坞站引擎，标准程序与单节点坞站相同。</p><p>--autolock-true或false-为管理器节点启用自动锁定-本帖子稍后将详细介绍。</p><p>--可用性-云处于活动状态(允许新任务)、暂停(不允许执行新任务，但旧任务仍在继续)或排出(不允许执行新任务，如果存在则立即完成旧任务)-为管理器节点设置排出，以创建没有容器的管理器。</p><p>--default-addr-pool-默认为10.10.10.0/8-我们可以为使用cluster创建的覆盖网络设置另一个地址池。</p><p>[lukas@docker-host1~]$docker sarm init--advertise-addr 10.10.10.20--Listen-addr 10.10.10.20已初始化的群：当前节点(X7mdjbmfz3ttkxbvelriix4yz)现在是管理器。要向此群中添加工作进程，请运行以下命令：docker sarm Join--Token SWMTKN-1-0zwqchv43d2alvl99fgw2mh6cnv7xc8vakspd90yjh4i7eiwwx-cn32plktlwjf8q25azk37ij5v 10.10.10.20：2377要向此群中添加管理器，请运行&#39。</p><p>如果我们稍后需要令牌，并且我们没有写下它们，我们可以从任何管理器节点获取它们。</p><p>[lukas@docker-host1~]$docker sarm Join-Token SWMTKN-1-0zwqchv43d2alvl99fgw2mh6cnv7xc8vakspd90yjh4i7eiwwx-956h96o5ivrekolr42k71bgqc要将管理员添加到此群集，请运行以下命令：docker sarm join--Token Manager 10.10.10.20：2377。</p><p>[lukas@docker-host1~]$docker sarm Join-Token SWMTKN-1-0zwqchv43d2alvl99fgw2mh6cnv7xc8vakspd90yjh4i7eiwwx-cn32plktlwjf8q25azk37ij5v要将Worker添加到此群中，请运行以下命令：docker sarm join--Token work10.10.10.20：2377。</p><p>令牌应该得到很好的保护，它们提供对集群的访问。如果它们在某个地方泄漏，我们应该用命令更改它们(我们可以轮换工人或经理)：</p><p>[lukas@docker-host1~]$docker sarm Join-Token--Rotate workerSuccessful Rotated Worker Join令牌。要将Worker添加到此群中，请运行以下命令：docker sarm Join--Token SWMTKN-1-0zwqchv43d2alvl99fgw2mh6cnv7xc8vakspd90yjh4i7eiwwx-c7r78dy7kwho1zq3uq7w26xhl 10.10.10.20：2377。</p><p>[lukas@docker-host2~]$docker群加入--Token SWMTKN-1-0zwqchv43d2alvl99fgw2mh6cnv7xc8vakspd90yjh4i7eiwwx-cn32plktlwjf8q25azk37ij5v 10.10.10.20：2377此节点作为工作者加入群。</p><p>[lukas@docker-host3~]$docker群加入--Token SWMTKN-1-0zwqchv43d2alvl99fgw2mh6cnv7xc8vakspd90yjh4i7eiwwx-cn32plktlwjf8q25azk37ij5v 10.10.10.20：2377此节点作为工作者加入群。</p><p>[lukas@docker-host1~]$docker node lsID主机名状态可用性管理器状态引擎VERSIONx7mdjbmfz3ttkxbvelriix4yz*docker-host1.lukas.int Ready Active Leader 19.03.8va779vfr6v115025a15yvuntv docker-host2.lukas.int Ready Active 19.03.8k61h5c7sqzjepifp6ll.。</p><p>强烈建议生产群集中至少有三个管理器节点用于HA。此配置在一个管理器节点丢失后仍然有效。在这样的配置下，仍然只有一位经理将成为领导者，其余的将从他那里复制数据，并等待他的崩溃。</p><p>此类型的节点仅托管计划容器。可以通过docker node升级命令将其提升为经理。</p><p>[lukas@docker-host1~]$docker节点检查docker-host2.lukas.int--BeautyID：va779vfr6v115025a15yvuntwHostname：docker-host2.lukas.int联接位置：2020-04-24 13：44：41.431444118+0000utcStatus：State：Ready Availability：Active Address：10.10.10.21Platform：Operating System：linux Architecture：x86_64Resources：cpu：2 Memory(连接位置：2020-04-24 13：44：41.431444118+0000utcStatus：State：Ready Availability：Active Address：10.10.10.21平台：操作系统：linux架构：x86_64资源：CPU：2内存。</p><p>如果没有--Pretty标志，我们会得到描述节点的原始json。我们可以使用--format标志从中获取确切信息。</p><p>[lukas@docker-host1~]$docker node update--可用性排出docker-host3.lukas.intdocker-host3.lukas.int[lukas@docker-host1~]$docker节点lsID主机名状态可用性管理器状态引擎VERSIONx7mdjbmfz3ttkxbvelriix4yz*docker-host1.lukas.int Ready Active Leader 19.03.8va779vfr6v。</p><p>[lukas@docker-host1~]$docker节点将docker-host3.lukas.intNode docker-host3.lukas.int提升为群中的经理。[lukas@docker-host1~]$docker node lsID主机名状态可用性管理器状态引擎VERSIONx7mdjbmfz3ttkxbvelriix4yz*docker-host1.lukas.int Ready Active Leader 19.03.8va779vfr6v115025a15yvuntv docker-host2.lukas.int Ready Active 19.03.8nqe3eyk55lvmwsmqy5。</p><p>如果我们想保护这些密钥，可以启用自动锁定功能。启用后，在节点重启后，需要使用s解密其配置数据</p><div class="text-break sotry_link"><a target="_blank" href="https://knowledgepill.it/posts/docker_swarm_compendium/">https://knowledgepill.it/posts/docker_swarm_compendium/</a></div><div class="story_tags"><button type="button" class="btn btn-light my_tag"><a href="/tag/service/">#service</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/节点/">#节点</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/docker/">#docker</a></button></div></div></div><div class="col-lg-4 col-0"><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/百度/">#百度</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/搜索/">#搜索</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button></div></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script></body></html>